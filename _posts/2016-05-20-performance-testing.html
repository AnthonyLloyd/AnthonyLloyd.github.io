---
layout: post
title: "Modularity from Lazy Evaluation - Performance Testing"
tags: [modularity,higher-order,lazy evaluation,performance,testing]
description: ""
keywords: f#, fsharp, functional, higher-order functions, lazy evaluation, modularity, performance, testing
---
<p>This is the second example of how higher-order functions and lazy evaluation can reduce complexity and lead to more modular software.</p>
<h2><a name="Background" class="anchor" href="#Background">Background</a></h2>
<p>To performance test code a number of iterations have to be performed so a more stable average can be compared.
The number of iterations is usually an input and chosen arbitrarily.</p>
<p>This post covers how statistical tests can be used to remove the need for this input.
This simplifies performance testing and makes the results more robust and useful.</p>
<h2><a name="Statistics" class="anchor" href="#Statistics">Statistics</a></h2>
<p>Lazy evaluation can be used to produce an <a href="https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Online_algorithm">online</a> sample statistics sequence.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Standard_error">standard error</a> of a sample mean is given by</p>
<p><span class="math">\[SE_{\bar{x}} = \frac{s}{\sqrt{n}}\]</span></p>
<p>The statistics sequence can be iterated until a given mean standard error level of accuracy is achieved.</p>
<p><a href="https://en.wikipedia.org/wiki/Welch%27s_t-test">Welch's t-test</a> for comparing the mean of two samples is given by</p>
<p><span class="math">\[t = \frac{\bar{x}_1-\bar{x}_2}{\sqrt{f_1+f_2}}\]</span></p>
<p><span class="math">\[df = \frac{\left(f_1+f_2\right)^2}{\frac{f_1^2}{n_1-1}+\frac{f_2^2}{n_2-1}}\]</span></p>
<p><span class="math">\[f_i = \frac{s_i^2}{n_i}\]</span></p>
<p>where <span class="math">\(n\)</span> is the sample size, <span class="math">\(\bar{x}\)</span> is the sample mean, <span class="math">\(s^2\)</span> is the sample variance, <span class="math">\(t\)</span> is Welch's t statistic, and <span class="math">\(df\)</span> is the degrees of freedom of the statistic.</p>
<p>Welch's t statistic can be compared to the inverse Student's t-distribution for a given confidence level to test if the sample means are different.</p>
<p>Two sample statistics sequences can be iterated together and compared to decide if one mean is larger than the other.</p>
<h2><a name="Statistics-code" class="anchor" href="#Statistics-code">Statistics code</a></h2>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="rt">SampleStatistics</span> <span class="o">=</span> <span class="pn">{</span><span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="id">N</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="vt">int</span><span class="pn">;</span><span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="id">Mean</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="vt">float</span><span class="pn">;</span><span onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13)" class="id">Variance</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs9', 14)" onmouseover="showTip(event, 'fs9', 14)" class="vt">float</span><span class="pn">}</span>
                        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="id">s</span><span class="pn">.</span><span class="prop">StandardDeviation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="fn">sqrt</span> <span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="id">Variance</span>
                        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs11', 19)" onmouseover="showTip(event, 'fs11', 19)" class="id">s</span><span class="pn">.</span><span class="prop">MeanStandardError</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="fn">sqrt</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs11', 21)" onmouseover="showTip(event, 'fs11', 21)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="id">Variance</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 23)" onmouseover="showTip(event, 'fs9', 23)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs11', 24)" onmouseover="showTip(event, 'fs11', 24)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 25)" onmouseover="showTip(event, 'fs6', 25)" class="id">N</span><span class="pn">)</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="rt">WelchStatistic</span> <span class="o">=</span> <span class="pn">{</span><span onmouseout="hideTip(event, 'fs14', 27)" onmouseover="showTip(event, 'fs14', 27)" class="id">T</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs9', 28)" onmouseover="showTip(event, 'fs9', 28)" class="vt">float</span><span class="pn">;</span><span onmouseout="hideTip(event, 'fs15', 29)" onmouseover="showTip(event, 'fs15', 29)" class="id">DF</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs7', 30)" onmouseover="showTip(event, 'fs7', 30)" class="vt">int</span><span class="pn">}</span>

<span class="k">module</span> <span class="m">Statistics</span> <span class="o">=</span>
    <span class="c">/// Online statistics sequence for a given sample sequence.</span>
    <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs16', 31)" onmouseover="showTip(event, 'fs16', 31)" class="fn">sampleStatistics</span> <span onmouseout="hideTip(event, 'fs17', 32)" onmouseover="showTip(event, 'fs17', 32)" class="id">s</span> <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 33)" onmouseover="showTip(event, 'fs18', 33)" class="fn">calc</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs19', 34)" onmouseover="showTip(event, 'fs19', 34)" class="id">n</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs20', 35)" onmouseover="showTip(event, 'fs20', 35)" class="id">m</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs21', 36)" onmouseover="showTip(event, 'fs21', 36)" class="id">s</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs22', 37)" onmouseover="showTip(event, 'fs22', 37)" class="id">x</span> <span class="o">=</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 38)" onmouseover="showTip(event, 'fs23', 38)" class="id">m&#39;</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs20', 39)" onmouseover="showTip(event, 'fs20', 39)" class="id">m</span><span class="o">+</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs22', 40)" onmouseover="showTip(event, 'fs22', 40)" class="id">x</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs20', 41)" onmouseover="showTip(event, 'fs20', 41)" class="id">m</span><span class="pn">)</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 42)" onmouseover="showTip(event, 'fs9', 42)" class="fn">float</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs19', 43)" onmouseover="showTip(event, 'fs19', 43)" class="id">n</span><span class="o">+</span><span class="n">1</span><span class="pn">)</span>
            <span onmouseout="hideTip(event, 'fs19', 44)" onmouseover="showTip(event, 'fs19', 44)" class="id">n</span><span class="o">+</span><span class="n">1</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs23', 45)" onmouseover="showTip(event, 'fs23', 45)" class="id">m&#39;</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs21', 46)" onmouseover="showTip(event, 'fs21', 46)" class="id">s</span><span class="o">+</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs22', 47)" onmouseover="showTip(event, 'fs22', 47)" class="id">x</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs20', 48)" onmouseover="showTip(event, 'fs20', 48)" class="id">m</span><span class="pn">)</span><span class="o">*</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs22', 49)" onmouseover="showTip(event, 'fs22', 49)" class="id">x</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs23', 50)" onmouseover="showTip(event, 'fs23', 50)" class="id">m&#39;</span><span class="pn">)</span>
        <span onmouseout="hideTip(event, 'fs24', 51)" onmouseover="showTip(event, 'fs24', 51)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs25', 52)" onmouseover="showTip(event, 'fs25', 52)" class="id">map</span> <span onmouseout="hideTip(event, 'fs9', 53)" onmouseover="showTip(event, 'fs9', 53)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs17', 54)" onmouseover="showTip(event, 'fs17', 54)" class="id">s</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs24', 55)" onmouseover="showTip(event, 'fs24', 55)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs26', 56)" onmouseover="showTip(event, 'fs26', 56)" class="id">scan</span> <span onmouseout="hideTip(event, 'fs18', 57)" onmouseover="showTip(event, 'fs18', 57)" class="fn">calc</span> <span class="pn">(</span><span class="n">0</span><span class="pn">,</span><span class="n">0.0</span><span class="pn">,</span><span class="n">0.0</span><span class="pn">)</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs24', 58)" onmouseover="showTip(event, 'fs24', 58)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs27', 59)" onmouseover="showTip(event, 'fs27', 59)" class="id">skip</span> <span class="n">3</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs24', 60)" onmouseover="showTip(event, 'fs24', 60)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs25', 61)" onmouseover="showTip(event, 'fs25', 61)" class="id">map</span> <span class="pn">(</span><span class="k">fun</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs19', 62)" onmouseover="showTip(event, 'fs19', 62)" class="id">n</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs20', 63)" onmouseover="showTip(event, 'fs20', 63)" class="id">m</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs21', 64)" onmouseover="showTip(event, 'fs21', 64)" class="id">s</span><span class="pn">)</span> <span class="k">-&gt;</span> <span class="pn">{</span><span onmouseout="hideTip(event, 'fs6', 65)" onmouseover="showTip(event, 'fs6', 65)" class="id">N</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs19', 66)" onmouseover="showTip(event, 'fs19', 66)" class="id">n</span><span class="pn">;</span><span class="id">Mean</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs20', 67)" onmouseover="showTip(event, 'fs20', 67)" class="id">m</span><span class="pn">;</span><span class="id">Variance</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs21', 68)" onmouseover="showTip(event, 'fs21', 68)" class="id">s</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 69)" onmouseover="showTip(event, 'fs9', 69)" class="fn">float</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs19', 70)" onmouseover="showTip(event, 'fs19', 70)" class="id">n</span><span class="o">-</span><span class="n">1</span><span class="pn">)</span><span class="pn">}</span><span class="pn">)</span>

    <span class="c">/// Scale the statistics for a given underlying random variable change of scale.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 71)" onmouseover="showTip(event, 'fs28', 71)" class="fn">scale</span> <span onmouseout="hideTip(event, 'fs29', 72)" onmouseover="showTip(event, 'fs29', 72)" class="id">f</span> <span onmouseout="hideTip(event, 'fs11', 73)" onmouseover="showTip(event, 'fs11', 73)" class="id">s</span> <span class="o">=</span> <span class="pn">{</span><span onmouseout="hideTip(event, 'fs11', 74)" onmouseover="showTip(event, 'fs11', 74)" class="id">s</span> <span class="k">with</span> <span class="id">Mean</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs11', 75)" onmouseover="showTip(event, 'fs11', 75)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 76)" onmouseover="showTip(event, 'fs8', 76)" class="id">Mean</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs29', 77)" onmouseover="showTip(event, 'fs29', 77)" class="id">f</span><span class="pn">;</span><span class="id">Variance</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs11', 78)" onmouseover="showTip(event, 'fs11', 78)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 79)" onmouseover="showTip(event, 'fs10', 79)" class="id">Variance</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs4', 80)" onmouseover="showTip(event, 'fs4', 80)" class="fn">sqr</span> <span onmouseout="hideTip(event, 'fs29', 81)" onmouseover="showTip(event, 'fs29', 81)" class="id">f</span><span class="pn">}</span>

    <span class="c">/// Single iteration statistics for a given iteration count and total statistics.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 82)" onmouseover="showTip(event, 'fs30', 82)" class="fn">singleIteration</span> <span onmouseout="hideTip(event, 'fs31', 83)" onmouseover="showTip(event, 'fs31', 83)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs11', 84)" onmouseover="showTip(event, 'fs11', 84)" class="id">s</span> <span class="o">=</span> <span class="pn">{</span><span onmouseout="hideTip(event, 'fs6', 85)" onmouseover="showTip(event, 'fs6', 85)" class="id">N</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs11', 86)" onmouseover="showTip(event, 'fs11', 86)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 87)" onmouseover="showTip(event, 'fs6', 87)" class="id">N</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs31', 88)" onmouseover="showTip(event, 'fs31', 88)" class="id">ic</span><span class="pn">;</span><span class="id">Mean</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs11', 89)" onmouseover="showTip(event, 'fs11', 89)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 90)" onmouseover="showTip(event, 'fs8', 90)" class="id">Mean</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 91)" onmouseover="showTip(event, 'fs9', 91)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs31', 92)" onmouseover="showTip(event, 'fs31', 92)" class="id">ic</span><span class="pn">;</span><span class="id">Variance</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs11', 93)" onmouseover="showTip(event, 'fs11', 93)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 94)" onmouseover="showTip(event, 'fs10', 94)" class="id">Variance</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 95)" onmouseover="showTip(event, 'fs9', 95)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs31', 96)" onmouseover="showTip(event, 'fs31', 96)" class="id">ic</span><span class="pn">}</span>

    <span class="c">/// Student&#39;s t-distribution inverse for 0.1% confidence level by degrees of freedom.</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs32', 97)" onmouseover="showTip(event, 'fs32', 97)" class="id">tInv</span> <span class="o">=</span> 
        <span class="pn">[|</span><span class="n">636.6</span><span class="pn">;</span><span class="n">31.60</span><span class="pn">;</span><span class="n">12.92</span><span class="pn">;</span><span class="n">8.610</span><span class="pn">;</span><span class="n">6.869</span><span class="pn">;</span><span class="n">5.959</span><span class="pn">;</span><span class="n">5.408</span><span class="pn">;</span><span class="n">5.041</span><span class="pn">;</span><span class="n">4.781</span><span class="pn">;</span><span class="n">4.587</span><span class="pn">;</span><span class="n">4.437</span><span class="pn">;</span><span class="n">4.318</span><span class="pn">;</span><span class="n">4.221</span><span class="pn">;</span>
          <span class="n">4.140</span><span class="pn">;</span><span class="n">4.073</span><span class="pn">;</span><span class="n">4.015</span><span class="pn">;</span><span class="n">3.965</span><span class="pn">;</span><span class="n">3.922</span><span class="pn">;</span><span class="n">3.883</span><span class="pn">;</span><span class="n">3.850</span><span class="pn">;</span><span class="n">3.819</span><span class="pn">;</span><span class="n">3.792</span><span class="pn">;</span><span class="n">3.768</span><span class="pn">;</span><span class="n">3.745</span><span class="pn">;</span><span class="n">3.725</span><span class="pn">;</span><span class="n">3.707</span><span class="pn">;</span>
          <span class="n">3.690</span><span class="pn">;</span><span class="n">3.674</span><span class="pn">;</span><span class="n">3.659</span><span class="pn">;</span><span class="n">3.646</span><span class="pn">;</span><span class="n">3.633</span><span class="pn">;</span><span class="n">3.622</span><span class="pn">;</span><span class="n">3.611</span><span class="pn">;</span><span class="n">3.601</span><span class="pn">;</span><span class="n">3.591</span><span class="pn">;</span><span class="n">3.582</span><span class="pn">;</span><span class="n">3.574</span><span class="pn">;</span><span class="n">3.566</span><span class="pn">;</span><span class="n">3.558</span><span class="pn">;</span>
          <span class="n">3.551</span><span class="pn">;</span><span class="n">3.544</span><span class="pn">;</span><span class="n">3.538</span><span class="pn">;</span><span class="n">3.532</span><span class="pn">;</span><span class="n">3.526</span><span class="pn">;</span><span class="n">3.520</span><span class="pn">;</span><span class="n">3.515</span><span class="pn">;</span><span class="n">3.510</span><span class="pn">;</span><span class="n">3.505</span><span class="pn">;</span><span class="n">3.500</span><span class="pn">;</span><span class="n">3.496</span><span class="pn">;</span><span class="n">3.492</span><span class="pn">;</span><span class="n">3.488</span><span class="pn">;</span>
          <span class="n">3.484</span><span class="pn">;</span><span class="n">3.480</span><span class="pn">;</span><span class="n">3.476</span><span class="pn">;</span><span class="n">3.473</span><span class="pn">;</span><span class="n">3.470</span><span class="pn">;</span><span class="n">3.466</span><span class="pn">;</span><span class="n">3.463</span><span class="pn">;</span><span class="n">3.460</span><span class="pn">;</span><span class="n">3.457</span><span class="pn">;</span><span class="n">3.454</span><span class="pn">;</span><span class="n">3.452</span><span class="pn">;</span><span class="n">3.449</span><span class="pn">;</span><span class="n">3.447</span><span class="pn">;</span>
          <span class="n">3.444</span><span class="pn">;</span><span class="n">3.442</span><span class="pn">;</span><span class="n">3.439</span><span class="pn">;</span><span class="n">3.437</span><span class="pn">;</span><span class="n">3.435</span><span class="pn">;</span><span class="n">3.433</span><span class="pn">;</span><span class="n">3.431</span><span class="pn">;</span><span class="n">3.429</span><span class="pn">;</span><span class="n">3.427</span><span class="pn">;</span><span class="n">3.425</span><span class="pn">;</span><span class="n">3.423</span><span class="pn">;</span><span class="n">3.421</span><span class="pn">;</span><span class="n">3.420</span><span class="pn">;</span>
          <span class="n">3.418</span><span class="pn">;</span><span class="n">3.416</span><span class="pn">;</span><span class="n">3.415</span><span class="pn">;</span><span class="n">3.413</span><span class="pn">;</span><span class="n">3.412</span><span class="pn">;</span><span class="n">3.410</span><span class="pn">;</span><span class="n">3.409</span><span class="pn">;</span><span class="n">3.407</span><span class="pn">;</span><span class="n">3.406</span><span class="pn">;</span><span class="n">3.405</span><span class="pn">;</span><span class="n">3.403</span><span class="pn">;</span><span class="n">3.402</span><span class="pn">;</span><span class="n">3.401</span><span class="pn">;</span>
          <span class="n">3.399</span><span class="pn">;</span><span class="n">3.398</span><span class="pn">;</span><span class="n">3.397</span><span class="pn">;</span><span class="n">3.396</span><span class="pn">;</span><span class="n">3.395</span><span class="pn">;</span><span class="n">3.394</span><span class="pn">;</span><span class="n">3.393</span><span class="pn">;</span><span class="n">3.392</span><span class="pn">;</span><span class="n">3.390</span><span class="pn">|]</span>

    <span class="c">/// Welch&#39;s t-test statistic for two given sample statistics.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 98)" onmouseover="showTip(event, 'fs33', 98)" class="fn">welchStatistic</span> <span onmouseout="hideTip(event, 'fs34', 99)" onmouseover="showTip(event, 'fs34', 99)" class="id">s1</span> <span onmouseout="hideTip(event, 'fs35', 100)" onmouseover="showTip(event, 'fs35', 100)" class="id">s2</span> <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 101)" onmouseover="showTip(event, 'fs36', 101)" class="id">f1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs34', 102)" onmouseover="showTip(event, 'fs34', 102)" class="id">s1</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 103)" onmouseover="showTip(event, 'fs10', 103)" class="id">Variance</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 104)" onmouseover="showTip(event, 'fs9', 104)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs34', 105)" onmouseover="showTip(event, 'fs34', 105)" class="id">s1</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 106)" onmouseover="showTip(event, 'fs6', 106)" class="id">N</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 107)" onmouseover="showTip(event, 'fs37', 107)" class="id">f2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs35', 108)" onmouseover="showTip(event, 'fs35', 108)" class="id">s2</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 109)" onmouseover="showTip(event, 'fs10', 109)" class="id">Variance</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 110)" onmouseover="showTip(event, 'fs9', 110)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs35', 111)" onmouseover="showTip(event, 'fs35', 111)" class="id">s2</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 112)" onmouseover="showTip(event, 'fs6', 112)" class="id">N</span>
        <span class="pn">{</span>
            <span onmouseout="hideTip(event, 'fs14', 113)" onmouseover="showTip(event, 'fs14', 113)" class="id">T</span> <span class="o">=</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs34', 114)" onmouseover="showTip(event, 'fs34', 114)" class="id">s1</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 115)" onmouseover="showTip(event, 'fs8', 115)" class="id">Mean</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs35', 116)" onmouseover="showTip(event, 'fs35', 116)" class="id">s2</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 117)" onmouseover="showTip(event, 'fs8', 117)" class="id">Mean</span><span class="pn">)</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs12', 118)" onmouseover="showTip(event, 'fs12', 118)" class="fn">sqrt</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs36', 119)" onmouseover="showTip(event, 'fs36', 119)" class="id">f1</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs37', 120)" onmouseover="showTip(event, 'fs37', 120)" class="id">f2</span><span class="pn">)</span>
            <span class="id">DF</span><span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs36', 121)" onmouseover="showTip(event, 'fs36', 121)" class="id">f1</span><span class="o">=</span><span class="n">0.0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs37', 122)" onmouseover="showTip(event, 'fs37', 122)" class="id">f2</span><span class="o">=</span><span class="n">0.0</span> <span class="k">then</span> <span class="n">1</span>
                <span class="k">else</span> <span onmouseout="hideTip(event, 'fs4', 123)" onmouseover="showTip(event, 'fs4', 123)" class="fn">sqr</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs36', 124)" onmouseover="showTip(event, 'fs36', 124)" class="id">f1</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs37', 125)" onmouseover="showTip(event, 'fs37', 125)" class="id">f2</span><span class="pn">)</span><span class="o">/</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs4', 126)" onmouseover="showTip(event, 'fs4', 126)" class="fn">sqr</span> <span onmouseout="hideTip(event, 'fs36', 127)" onmouseover="showTip(event, 'fs36', 127)" class="id">f1</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 128)" onmouseover="showTip(event, 'fs9', 128)" class="fn">float</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs34', 129)" onmouseover="showTip(event, 'fs34', 129)" class="id">s1</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 130)" onmouseover="showTip(event, 'fs6', 130)" class="id">N</span><span class="o">-</span><span class="n">1</span><span class="pn">)</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs4', 131)" onmouseover="showTip(event, 'fs4', 131)" class="fn">sqr</span> <span onmouseout="hideTip(event, 'fs37', 132)" onmouseover="showTip(event, 'fs37', 132)" class="id">f2</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 133)" onmouseover="showTip(event, 'fs9', 133)" class="fn">float</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs35', 134)" onmouseover="showTip(event, 'fs35', 134)" class="id">s2</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs6', 135)" onmouseover="showTip(event, 'fs6', 135)" class="id">N</span><span class="o">-</span><span class="n">1</span><span class="pn">)</span><span class="pn">)</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 136)" onmouseover="showTip(event, 'fs7', 136)" class="fn">int</span>
        <span class="pn">}</span>

    <span class="c">/// Welch&#39;s t-test for a given Welch statistic to a confidence level of 0.1%.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 137)" onmouseover="showTip(event, 'fs38', 137)" class="fn">welchTest</span> <span onmouseout="hideTip(event, 'fs39', 138)" onmouseover="showTip(event, 'fs39', 138)" class="id">w</span> <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs40', 139)" onmouseover="showTip(event, 'fs40', 139)" class="fn">abs</span> <span onmouseout="hideTip(event, 'fs39', 140)" onmouseover="showTip(event, 'fs39', 140)" class="id">w</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 141)" onmouseover="showTip(event, 'fs14', 141)" class="id">T</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs41', 142)" onmouseover="showTip(event, 'fs41', 142)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs42', 143)" onmouseover="showTip(event, 'fs42', 143)" class="id">get</span> <span onmouseout="hideTip(event, 'fs32', 144)" onmouseover="showTip(event, 'fs32', 144)" class="id">tInv</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs43', 145)" onmouseover="showTip(event, 'fs43', 145)" class="fn">min</span> <span onmouseout="hideTip(event, 'fs39', 146)" onmouseover="showTip(event, 'fs39', 146)" class="id">w</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs15', 147)" onmouseover="showTip(event, 'fs15', 147)" class="id">DF</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs41', 148)" onmouseover="showTip(event, 'fs41', 148)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs44', 149)" onmouseover="showTip(event, 'fs44', 149)" class="id">length</span> <span onmouseout="hideTip(event, 'fs32', 150)" onmouseover="showTip(event, 'fs32', 150)" class="id">tInv</span><span class="pn">)</span> <span class="o">-</span> <span class="n">1</span><span class="pn">)</span> <span class="k">then</span> <span class="n">0</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs45', 151)" onmouseover="showTip(event, 'fs45', 151)" class="fn">sign</span> <span onmouseout="hideTip(event, 'fs39', 152)" onmouseover="showTip(event, 'fs39', 152)" class="id">w</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 153)" onmouseover="showTip(event, 'fs14', 153)" class="id">T</span>
</code></pre>
<h2><a name="Performance-testing" class="anchor" href="#Performance-testing">Performance testing</a></h2>
<p>Three performance metrics will be created: time, memory allocated, and garbage collections.</p>
<p>Each of these will be repeated until at least the metric target is reached to ensure it is reliably measuring the metric and not any framework overhead.</p>
<p>Statistics functions will be created for each of the metrics to measure a function accurate to a mean standard error of 1%.</p>
<p>Compare functions will be created for each of the metrics to compare two functions to a confidence level of 0.1%.
The functions will be considered equal after 10,000 degrees of freedom have past without a positive test result.</p>
<h2><a name="Performance-testing-code" class="anchor" href="#Performance-testing-code">Performance testing code</a></h2>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span onmouseout="hideTip(event, 'fs47', 155)" onmouseover="showTip(event, 'fs47', 155)" class="m">Performance</span> <span class="o">=</span>
    <span class="c">/// Find the iteration count to get to at least the metric target.</span>
    <span class="k">let</span> <span class="k">inline</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs48', 156)" onmouseover="showTip(event, 'fs48', 156)" class="fn">targetIterationCount</span> <span onmouseout="hideTip(event, 'fs49', 157)" onmouseover="showTip(event, 'fs49', 157)" class="fn">metric</span> <span onmouseout="hideTip(event, 'fs50', 158)" onmouseover="showTip(event, 'fs50', 158)" class="id">metricTarget</span> <span onmouseout="hideTip(event, 'fs51', 159)" onmouseover="showTip(event, 'fs51', 159)" class="id">f</span> <span class="o">=</span>
        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs52', 160)" onmouseover="showTip(event, 'fs52', 160)" class="fn">find</span> <span onmouseout="hideTip(event, 'fs19', 161)" onmouseover="showTip(event, 'fs19', 161)" class="id">n</span> <span class="o">=</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 162)" onmouseover="showTip(event, 'fs53', 162)" class="id">item</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs49', 163)" onmouseover="showTip(event, 'fs49', 163)" class="fn">metric</span> <span onmouseout="hideTip(event, 'fs19', 164)" onmouseover="showTip(event, 'fs19', 164)" class="id">n</span> <span onmouseout="hideTip(event, 'fs51', 165)" onmouseover="showTip(event, 'fs51', 165)" class="id">f</span>
            <span class="k">if</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs53', 166)" onmouseover="showTip(event, 'fs53', 166)" class="id">item</span><span class="o">&lt;&lt;&lt;</span><span class="n">3</span><span class="pn">)</span><span class="o">&gt;</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs50', 167)" onmouseover="showTip(event, 'fs50', 167)" class="id">metricTarget</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs19', 168)" onmouseover="showTip(event, 'fs19', 168)" class="id">n</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs7', 169)" onmouseover="showTip(event, 'fs7', 169)" class="fn">int</span> <span onmouseout="hideTip(event, 'fs50', 170)" onmouseover="showTip(event, 'fs50', 170)" class="id">metricTarget</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs7', 171)" onmouseover="showTip(event, 'fs7', 171)" class="fn">int</span> <span onmouseout="hideTip(event, 'fs53', 172)" onmouseover="showTip(event, 'fs53', 172)" class="id">item</span><span class="o">+</span><span class="n">1</span>
            <span class="k">else</span> <span onmouseout="hideTip(event, 'fs52', 173)" onmouseover="showTip(event, 'fs52', 173)" class="fn">find</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs19', 174)" onmouseover="showTip(event, 'fs19', 174)" class="id">n</span><span class="o">*</span><span class="n">10</span><span class="pn">)</span>
        <span onmouseout="hideTip(event, 'fs52', 175)" onmouseover="showTip(event, 'fs52', 175)" class="fn">find</span> <span class="n">1</span>
        
    <span class="c">/// Create and iterate a statistics sequence for a metric until the given accuracy.</span>
    <span class="k">let</span> <span class="k">inline</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs54', 176)" onmouseover="showTip(event, 'fs54', 176)" class="fn">measureStatistics</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs55', 177)" onmouseover="showTip(event, 'fs55', 177)" class="fn">metric</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs56', 178)" onmouseover="showTip(event, 'fs56', 178)" class="id">metricTarget</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs57', 179)" onmouseover="showTip(event, 'fs57', 179)" class="id">relativeError</span> <span onmouseout="hideTip(event, 'fs51', 180)" onmouseover="showTip(event, 'fs51', 180)" class="id">f</span> <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 181)" onmouseover="showTip(event, 'fs31', 181)" class="id">ic</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs48', 182)" onmouseover="showTip(event, 'fs48', 182)" class="fn">targetIterationCount</span> <span onmouseout="hideTip(event, 'fs55', 183)" onmouseover="showTip(event, 'fs55', 183)" class="fn">metric</span> <span onmouseout="hideTip(event, 'fs56', 184)" onmouseover="showTip(event, 'fs56', 184)" class="id">metricTarget</span> <span onmouseout="hideTip(event, 'fs51', 185)" onmouseover="showTip(event, 'fs51', 185)" class="id">f</span>
        <span onmouseout="hideTip(event, 'fs24', 186)" onmouseover="showTip(event, 'fs24', 186)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs58', 187)" onmouseover="showTip(event, 'fs58', 187)" class="id">initInfinite</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">_</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs55', 188)" onmouseover="showTip(event, 'fs55', 188)" class="fn">metric</span> <span onmouseout="hideTip(event, 'fs31', 189)" onmouseover="showTip(event, 'fs31', 189)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs51', 190)" onmouseover="showTip(event, 'fs51', 190)" class="id">f</span><span class="pn">)</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 191)" onmouseover="showTip(event, 'fs16', 191)" class="fn">sampleStatistics</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs24', 192)" onmouseover="showTip(event, 'fs24', 192)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs25', 193)" onmouseover="showTip(event, 'fs25', 193)" class="id">map</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs30', 194)" onmouseover="showTip(event, 'fs30', 194)" class="fn">singleIteration</span> <span onmouseout="hideTip(event, 'fs31', 195)" onmouseover="showTip(event, 'fs31', 195)" class="id">ic</span><span class="pn">)</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs24', 196)" onmouseover="showTip(event, 'fs24', 196)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs59', 197)" onmouseover="showTip(event, 'fs59', 197)" class="id">find</span> <span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, 'fs11', 198)" onmouseover="showTip(event, 'fs11', 198)" class="id">s</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs11', 199)" onmouseover="showTip(event, 'fs11', 199)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs60', 200)" onmouseover="showTip(event, 'fs60', 200)" class="id">MeanStandardError</span><span class="o">&lt;=</span><span onmouseout="hideTip(event, 'fs57', 201)" onmouseover="showTip(event, 'fs57', 201)" class="id">relativeError</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs11', 202)" onmouseover="showTip(event, 'fs11', 202)" class="id">s</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 203)" onmouseover="showTip(event, 'fs8', 203)" class="id">Mean</span><span class="pn">)</span>

    <span class="c">/// Create and iterate two statistics sequences until the metric means can be compared.</span>
    <span class="k">let</span> <span class="k">inline</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs61', 204)" onmouseover="showTip(event, 'fs61', 204)" class="fn">measureCompare</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs62', 205)" onmouseover="showTip(event, 'fs62', 205)" class="fn">metric</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs63', 206)" onmouseover="showTip(event, 'fs63', 206)" class="id">metricTarget</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs64', 207)" onmouseover="showTip(event, 'fs64', 207)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs65', 208)" onmouseover="showTip(event, 'fs65', 208)" class="fn">f2</span> <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs64', 209)" onmouseover="showTip(event, 'fs64', 209)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs66', 210)" onmouseover="showTip(event, 'fs66', 210)" class="fn">id</span><span class="o">&lt;&gt;</span><span onmouseout="hideTip(event, 'fs65', 211)" onmouseover="showTip(event, 'fs65', 211)" class="fn">f2</span> <span onmouseout="hideTip(event, 'fs66', 212)" onmouseover="showTip(event, 'fs66', 212)" class="fn">id</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs67', 213)" onmouseover="showTip(event, 'fs67', 213)" class="fn">failwith</span> <span class="s">&quot;function results are not the same&quot;</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 214)" onmouseover="showTip(event, 'fs31', 214)" class="id">ic</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs48', 215)" onmouseover="showTip(event, 'fs48', 215)" class="fn">targetIterationCount</span> <span onmouseout="hideTip(event, 'fs62', 216)" onmouseover="showTip(event, 'fs62', 216)" class="fn">metric</span> <span onmouseout="hideTip(event, 'fs63', 217)" onmouseover="showTip(event, 'fs63', 217)" class="id">metricTarget</span> <span onmouseout="hideTip(event, 'fs65', 218)" onmouseover="showTip(event, 'fs65', 218)" class="fn">f2</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 219)" onmouseover="showTip(event, 'fs68', 219)" class="fn">stats</span> <span onmouseout="hideTip(event, 'fs69', 220)" onmouseover="showTip(event, 'fs69', 220)" class="fn">f</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 221)" onmouseover="showTip(event, 'fs24', 221)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs58', 222)" onmouseover="showTip(event, 'fs58', 222)" class="id">initInfinite</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">_</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs62', 223)" onmouseover="showTip(event, 'fs62', 223)" class="fn">metric</span> <span onmouseout="hideTip(event, 'fs31', 224)" onmouseover="showTip(event, 'fs31', 224)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs69', 225)" onmouseover="showTip(event, 'fs69', 225)" class="fn">f</span><span class="pn">)</span>
                      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 226)" onmouseover="showTip(event, 'fs16', 226)" class="fn">sampleStatistics</span>
                      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs24', 227)" onmouseover="showTip(event, 'fs24', 227)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs25', 228)" onmouseover="showTip(event, 'fs25', 228)" class="id">map</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs30', 229)" onmouseover="showTip(event, 'fs30', 229)" class="fn">singleIteration</span> <span onmouseout="hideTip(event, 'fs31', 230)" onmouseover="showTip(event, 'fs31', 230)" class="id">ic</span><span class="pn">)</span>
        <span onmouseout="hideTip(event, 'fs24', 231)" onmouseover="showTip(event, 'fs24', 231)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs70', 232)" onmouseover="showTip(event, 'fs70', 232)" class="id">map2</span> <span onmouseout="hideTip(event, 'fs33', 233)" onmouseover="showTip(event, 'fs33', 233)" class="fn">welchStatistic</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs68', 234)" onmouseover="showTip(event, 'fs68', 234)" class="fn">stats</span> <span onmouseout="hideTip(event, 'fs64', 235)" onmouseover="showTip(event, 'fs64', 235)" class="fn">f1</span><span class="pn">)</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs68', 236)" onmouseover="showTip(event, 'fs68', 236)" class="fn">stats</span> <span onmouseout="hideTip(event, 'fs65', 237)" onmouseover="showTip(event, 'fs65', 237)" class="fn">f2</span><span class="pn">)</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs24', 238)" onmouseover="showTip(event, 'fs24', 238)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs71', 239)" onmouseover="showTip(event, 'fs71', 239)" class="id">pick</span> <span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, 'fs39', 240)" onmouseover="showTip(event, 'fs39', 240)" class="id">w</span> <span class="k">-&gt;</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 241)" onmouseover="showTip(event, 'fs72', 241)" class="id">maxDF</span> <span class="o">=</span> <span class="n">10000</span>
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs39', 242)" onmouseover="showTip(event, 'fs39', 242)" class="id">w</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs15', 243)" onmouseover="showTip(event, 'fs15', 243)" class="id">DF</span><span class="o">&gt;</span><span onmouseout="hideTip(event, 'fs72', 244)" onmouseover="showTip(event, 'fs72', 244)" class="id">maxDF</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs73', 245)" onmouseover="showTip(event, 'fs73', 245)" class="uc">Some</span> <span class="n">0</span> <span class="k">else</span> <span class="k">match</span> <span onmouseout="hideTip(event, 'fs38', 246)" onmouseover="showTip(event, 'fs38', 246)" class="fn">welchTest</span> <span onmouseout="hideTip(event, 'fs39', 247)" onmouseover="showTip(event, 'fs39', 247)" class="id">w</span> <span class="k">with</span> <span class="pn">|</span><span class="n">0</span><span class="k">-&gt;</span><span onmouseout="hideTip(event, 'fs74', 248)" onmouseover="showTip(event, 'fs74', 248)" class="uc">None</span> <span class="pn">|</span><span onmouseout="hideTip(event, 'fs75', 249)" onmouseover="showTip(event, 'fs75', 249)" class="id">c</span><span class="k">-&gt;</span><span onmouseout="hideTip(event, 'fs73', 250)" onmouseover="showTip(event, 'fs73', 250)" class="uc">Some</span> <span onmouseout="hideTip(event, 'fs75', 251)" onmouseover="showTip(event, 'fs75', 251)" class="id">c</span><span class="pn">)</span>

    <span class="c">/// Measure the given function for the iteration count using the start and end metric.</span>
    <span class="k">let</span> <span class="k">inline</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs76', 252)" onmouseover="showTip(event, 'fs76', 252)" class="fn">measureMetric</span> <span onmouseout="hideTip(event, 'fs77', 253)" onmouseover="showTip(event, 'fs77', 253)" class="fn">startMetric</span> <span onmouseout="hideTip(event, 'fs78', 254)" onmouseover="showTip(event, 'fs78', 254)" class="fn">endMetric</span> <span onmouseout="hideTip(event, 'fs31', 255)" onmouseover="showTip(event, 'fs31', 255)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs79', 256)" onmouseover="showTip(event, 'fs79', 256)" class="fn">f</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs80', 257)" onmouseover="showTip(event, 'fs80', 257)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs81', 258)" onmouseover="showTip(event, 'fs81', 258)" class="id">Collect</span><span class="pn">(</span><span class="pn">)</span>
        <span onmouseout="hideTip(event, 'fs80', 259)" onmouseover="showTip(event, 'fs80', 259)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs82', 260)" onmouseover="showTip(event, 'fs82', 260)" class="id">WaitForPendingFinalizers</span><span class="pn">(</span><span class="pn">)</span>
        <span onmouseout="hideTip(event, 'fs80', 261)" onmouseover="showTip(event, 'fs80', 261)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs81', 262)" onmouseover="showTip(event, 'fs81', 262)" class="id">Collect</span><span class="pn">(</span><span class="pn">)</span>
        <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs83', 263)" onmouseover="showTip(event, 'fs83', 263)" class="mv">total</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs84', 264)" onmouseover="showTip(event, 'fs84', 264)" class="m">LanguagePrimitives</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs85', 265)" onmouseover="showTip(event, 'fs85', 265)" class="id">GenericZero</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 266)" onmouseover="showTip(event, 'fs86', 266)" class="fn">measurer</span> <span onmouseout="hideTip(event, 'fs87', 267)" onmouseover="showTip(event, 'fs87', 267)" class="fn">toMeasure</span> <span class="o">=</span>
            <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs88', 268)" onmouseover="showTip(event, 'fs88', 268)" class="id">args</span> <span class="k">-&gt;</span>
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs89', 269)" onmouseover="showTip(event, 'fs89', 269)" class="id">s</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs77', 270)" onmouseover="showTip(event, 'fs77', 270)" class="fn">startMetric</span><span class="pn">(</span><span class="pn">)</span>
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs90', 271)" onmouseover="showTip(event, 'fs90', 271)" class="id">ret</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs87', 272)" onmouseover="showTip(event, 'fs87', 272)" class="fn">toMeasure</span> <span onmouseout="hideTip(event, 'fs88', 273)" onmouseover="showTip(event, 'fs88', 273)" class="id">args</span>
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs91', 274)" onmouseover="showTip(event, 'fs91', 274)" class="id">m</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs78', 275)" onmouseover="showTip(event, 'fs78', 275)" class="fn">endMetric</span> <span onmouseout="hideTip(event, 'fs89', 276)" onmouseover="showTip(event, 'fs89', 276)" class="id">s</span>
                <span onmouseout="hideTip(event, 'fs83', 277)" onmouseover="showTip(event, 'fs83', 277)" class="mv">total</span><span class="k">&lt;-</span><span onmouseout="hideTip(event, 'fs83', 278)" onmouseover="showTip(event, 'fs83', 278)" class="mv">total</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs91', 279)" onmouseover="showTip(event, 'fs91', 279)" class="id">m</span>
                <span onmouseout="hideTip(event, 'fs90', 280)" onmouseover="showTip(event, 'fs90', 280)" class="id">ret</span>
        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs92', 281)" onmouseover="showTip(event, 'fs92', 281)" class="fn">loop</span> <span onmouseout="hideTip(event, 'fs93', 282)" onmouseover="showTip(event, 'fs93', 282)" class="id">i</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs93', 283)" onmouseover="showTip(event, 'fs93', 283)" class="id">i</span><span class="o">&gt;</span><span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs79', 284)" onmouseover="showTip(event, 'fs79', 284)" class="fn">f</span> <span onmouseout="hideTip(event, 'fs86', 285)" onmouseover="showTip(event, 'fs86', 285)" class="fn">measurer</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs94', 286)" onmouseover="showTip(event, 'fs94', 286)" class="fn">ignore</span><span class="pn">;</span> <span onmouseout="hideTip(event, 'fs92', 287)" onmouseover="showTip(event, 'fs92', 287)" class="fn">loop</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs93', 288)" onmouseover="showTip(event, 'fs93', 288)" class="id">i</span><span class="o">-</span><span class="n">1</span><span class="pn">)</span>
        <span onmouseout="hideTip(event, 'fs92', 289)" onmouseover="showTip(event, 'fs92', 289)" class="fn">loop</span> <span onmouseout="hideTip(event, 'fs31', 290)" onmouseover="showTip(event, 'fs31', 290)" class="id">ic</span>
        <span onmouseout="hideTip(event, 'fs83', 291)" onmouseover="showTip(event, 'fs83', 291)" class="mv">total</span>
    
    <span class="c">/// Measure the time metric for the given function and iteration count.</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs95', 292)" onmouseover="showTip(event, 'fs95', 292)" class="fn">timeMetric</span> <span onmouseout="hideTip(event, 'fs31', 293)" onmouseover="showTip(event, 'fs31', 293)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs96', 294)" onmouseover="showTip(event, 'fs96', 294)" class="fn">f</span> <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs76', 295)" onmouseover="showTip(event, 'fs76', 295)" class="fn">measureMetric</span> <span onmouseout="hideTip(event, 'fs97', 296)" onmouseover="showTip(event, 'fs97', 296)" class="rt">Stopwatch</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs98', 297)" onmouseover="showTip(event, 'fs98', 297)" class="id">GetTimestamp</span> <span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, 'fs99', 298)" onmouseover="showTip(event, 'fs99', 298)" class="id">t</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs97', 299)" onmouseover="showTip(event, 'fs97', 299)" class="rt">Stopwatch</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs98', 300)" onmouseover="showTip(event, 'fs98', 300)" class="id">GetTimestamp</span><span class="pn">(</span><span class="pn">)</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs99', 301)" onmouseover="showTip(event, 'fs99', 301)" class="id">t</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs31', 302)" onmouseover="showTip(event, 'fs31', 302)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs96', 303)" onmouseover="showTip(event, 'fs96', 303)" class="fn">f</span>
        
    <span class="c">/// Measure the memory metric for the given function and iteration count.</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs100', 304)" onmouseover="showTip(event, 'fs100', 304)" class="fn">memoryMetric</span> <span onmouseout="hideTip(event, 'fs31', 305)" onmouseover="showTip(event, 'fs31', 305)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs96', 306)" onmouseover="showTip(event, 'fs96', 306)" class="fn">f</span> <span class="o">=</span>
        <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs101', 307)" onmouseover="showTip(event, 'fs101', 307)" class="fn">startMetric</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span>
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs80', 308)" onmouseover="showTip(event, 'fs80', 308)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs102', 309)" onmouseover="showTip(event, 'fs102', 309)" class="id">TryStartNoGCRegion</span><span class="pn">(</span><span class="n">1L</span><span class="o">&lt;&lt;&lt;</span><span class="n">22</span><span class="pn">)</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 310)" onmouseover="showTip(event, 'fs103', 310)" class="fn">not</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs67', 311)" onmouseover="showTip(event, 'fs67', 311)" class="fn">failwith</span> <span class="s">&quot;TryStartNoGCRegion&quot;</span>
            <span onmouseout="hideTip(event, 'fs80', 312)" onmouseover="showTip(event, 'fs80', 312)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs104', 313)" onmouseover="showTip(event, 'fs104', 313)" class="id">GetTotalMemory</span> <span class="k">false</span>
        <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs105', 314)" onmouseover="showTip(event, 'fs105', 314)" class="fn">endMetric</span> <span onmouseout="hideTip(event, 'fs106', 315)" onmouseover="showTip(event, 'fs106', 315)" class="id">s</span> <span class="o">=</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs99', 316)" onmouseover="showTip(event, 'fs99', 316)" class="id">t</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs80', 317)" onmouseover="showTip(event, 'fs80', 317)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs104', 318)" onmouseover="showTip(event, 'fs104', 318)" class="id">GetTotalMemory</span> <span class="k">false</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs106', 319)" onmouseover="showTip(event, 'fs106', 319)" class="id">s</span>
            <span onmouseout="hideTip(event, 'fs80', 320)" onmouseover="showTip(event, 'fs80', 320)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs107', 321)" onmouseover="showTip(event, 'fs107', 321)" class="id">EndNoGCRegion</span><span class="pn">(</span><span class="pn">)</span>
            <span onmouseout="hideTip(event, 'fs99', 322)" onmouseover="showTip(event, 'fs99', 322)" class="id">t</span>
        <span onmouseout="hideTip(event, 'fs76', 323)" onmouseover="showTip(event, 'fs76', 323)" class="fn">measureMetric</span> <span onmouseout="hideTip(event, 'fs101', 324)" onmouseover="showTip(event, 'fs101', 324)" class="fn">startMetric</span> <span onmouseout="hideTip(event, 'fs105', 325)" onmouseover="showTip(event, 'fs105', 325)" class="fn">endMetric</span> <span onmouseout="hideTip(event, 'fs31', 326)" onmouseover="showTip(event, 'fs31', 326)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs96', 327)" onmouseover="showTip(event, 'fs96', 327)" class="fn">f</span>

    <span class="c">/// Measure the garbage collection metric for the given function and iteration count.</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs108', 328)" onmouseover="showTip(event, 'fs108', 328)" class="fn">garbageMetric</span> <span onmouseout="hideTip(event, 'fs31', 329)" onmouseover="showTip(event, 'fs31', 329)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs96', 330)" onmouseover="showTip(event, 'fs96', 330)" class="fn">f</span> <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs109', 331)" onmouseover="showTip(event, 'fs109', 331)" class="fn">count</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs80', 332)" onmouseover="showTip(event, 'fs80', 332)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs110', 333)" onmouseover="showTip(event, 'fs110', 333)" class="id">CollectionCount</span> <span class="n">0</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs80', 334)" onmouseover="showTip(event, 'fs80', 334)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs110', 335)" onmouseover="showTip(event, 'fs110', 335)" class="id">CollectionCount</span> <span class="n">1</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs80', 336)" onmouseover="showTip(event, 'fs80', 336)" class="rt">GC</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs110', 337)" onmouseover="showTip(event, 'fs110', 337)" class="id">CollectionCount</span> <span class="n">2</span>
        <span onmouseout="hideTip(event, 'fs76', 338)" onmouseover="showTip(event, 'fs76', 338)" class="fn">measureMetric</span> <span onmouseout="hideTip(event, 'fs109', 339)" onmouseover="showTip(event, 'fs109', 339)" class="fn">count</span> <span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, 'fs111', 340)" onmouseover="showTip(event, 'fs111', 340)" class="id">s</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs109', 341)" onmouseover="showTip(event, 'fs109', 341)" class="fn">count</span><span class="pn">(</span><span class="pn">)</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs111', 342)" onmouseover="showTip(event, 'fs111', 342)" class="id">s</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs31', 343)" onmouseover="showTip(event, 'fs31', 343)" class="id">ic</span> <span onmouseout="hideTip(event, 'fs96', 344)" onmouseover="showTip(event, 'fs96', 344)" class="fn">f</span>

    <span class="c">/// Measure definitions which are a metric together with a metric target.</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs112', 345)" onmouseover="showTip(event, 'fs112', 345)" class="id">oneMillisecond</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs97', 346)" onmouseover="showTip(event, 'fs97', 346)" class="rt">Stopwatch</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs113', 347)" onmouseover="showTip(event, 'fs113', 347)" class="id">Frequency</span><span class="o">/</span><span class="n">1000L</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs114', 348)" onmouseover="showTip(event, 'fs114', 348)" class="id">timeMeasure</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs95', 349)" onmouseover="showTip(event, 'fs95', 349)" class="fn">timeMetric</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs112', 350)" onmouseover="showTip(event, 'fs112', 350)" class="id">oneMillisecond</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs115', 351)" onmouseover="showTip(event, 'fs115', 351)" class="id">memoryMeasure</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs100', 352)" onmouseover="showTip(event, 'fs100', 352)" class="fn">memoryMetric</span><span class="pn">,</span> <span class="n">1024L</span> <span class="c">//1KB</span>
    <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs116', 353)" onmouseover="showTip(event, 'fs116', 353)" class="id">garbageMeasure</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs108', 354)" onmouseover="showTip(event, 'fs108', 354)" class="fn">garbageMetric</span><span class="pn">,</span> <span class="n">10</span>

    <span class="c">/// Time statistics for a given function accurate to a mean standard error of 1%.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs117', 355)" onmouseover="showTip(event, 'fs117', 355)" class="fn">timeStatistics</span> <span onmouseout="hideTip(event, 'fs96', 356)" onmouseover="showTip(event, 'fs96', 356)" class="fn">f</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs54', 357)" onmouseover="showTip(event, 'fs54', 357)" class="fn">measureStatistics</span> <span onmouseout="hideTip(event, 'fs114', 358)" onmouseover="showTip(event, 'fs114', 358)" class="id">timeMeasure</span> <span class="n">0.01</span> <span onmouseout="hideTip(event, 'fs96', 359)" onmouseover="showTip(event, 'fs96', 359)" class="fn">f</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs28', 360)" onmouseover="showTip(event, 'fs28', 360)" class="fn">scale</span> <span class="pn">(</span><span class="n">1.0</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs9', 361)" onmouseover="showTip(event, 'fs9', 361)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs97', 362)" onmouseover="showTip(event, 'fs97', 362)" class="rt">Stopwatch</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs113', 363)" onmouseover="showTip(event, 'fs113', 363)" class="id">Frequency</span><span class="pn">)</span>
    <span class="c">/// Memory statistics for a given function accurate to a mean standard error of 1%.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs118', 364)" onmouseover="showTip(event, 'fs118', 364)" class="fn">memoryStatistics</span> <span onmouseout="hideTip(event, 'fs96', 365)" onmouseover="showTip(event, 'fs96', 365)" class="fn">f</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs54', 366)" onmouseover="showTip(event, 'fs54', 366)" class="fn">measureStatistics</span> <span onmouseout="hideTip(event, 'fs115', 367)" onmouseover="showTip(event, 'fs115', 367)" class="id">memoryMeasure</span> <span class="n">0.01</span> <span onmouseout="hideTip(event, 'fs96', 368)" onmouseover="showTip(event, 'fs96', 368)" class="fn">f</span>
    <span class="c">/// GC count statistics for a given function accurate to a mean standard error of 1%.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 369)" onmouseover="showTip(event, 'fs119', 369)" class="fn">gcCountStatistics</span> <span onmouseout="hideTip(event, 'fs96', 370)" onmouseover="showTip(event, 'fs96', 370)" class="fn">f</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs54', 371)" onmouseover="showTip(event, 'fs54', 371)" class="fn">measureStatistics</span> <span onmouseout="hideTip(event, 'fs116', 372)" onmouseover="showTip(event, 'fs116', 372)" class="id">garbageMeasure</span> <span class="n">0.01</span> <span onmouseout="hideTip(event, 'fs96', 373)" onmouseover="showTip(event, 'fs96', 373)" class="fn">f</span>
    
    <span class="c">/// Time comparison for two given functions to a confidence level of 0.1%.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 374)" onmouseover="showTip(event, 'fs120', 374)" class="fn">timeCompare</span> <span onmouseout="hideTip(event, 'fs121', 375)" onmouseover="showTip(event, 'fs121', 375)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs122', 376)" onmouseover="showTip(event, 'fs122', 376)" class="fn">f2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs61', 377)" onmouseover="showTip(event, 'fs61', 377)" class="fn">measureCompare</span> <span onmouseout="hideTip(event, 'fs114', 378)" onmouseover="showTip(event, 'fs114', 378)" class="id">timeMeasure</span> <span onmouseout="hideTip(event, 'fs121', 379)" onmouseover="showTip(event, 'fs121', 379)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs122', 380)" onmouseover="showTip(event, 'fs122', 380)" class="fn">f2</span>
    <span class="c">/// Memory comparison for two given functions to a confidence level of 0.1%.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs123', 381)" onmouseover="showTip(event, 'fs123', 381)" class="fn">memoryCompare</span> <span onmouseout="hideTip(event, 'fs121', 382)" onmouseover="showTip(event, 'fs121', 382)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs122', 383)" onmouseover="showTip(event, 'fs122', 383)" class="fn">f2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs61', 384)" onmouseover="showTip(event, 'fs61', 384)" class="fn">measureCompare</span> <span onmouseout="hideTip(event, 'fs115', 385)" onmouseover="showTip(event, 'fs115', 385)" class="id">memoryMeasure</span> <span onmouseout="hideTip(event, 'fs121', 386)" onmouseover="showTip(event, 'fs121', 386)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs122', 387)" onmouseover="showTip(event, 'fs122', 387)" class="fn">f2</span>
    <span class="c">/// GC count comparison for two given functions to a confidence level of 0.1%.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs124', 388)" onmouseover="showTip(event, 'fs124', 388)" class="fn">gcCountCompare</span> <span onmouseout="hideTip(event, 'fs121', 389)" onmouseover="showTip(event, 'fs121', 389)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs122', 390)" onmouseover="showTip(event, 'fs122', 390)" class="fn">f2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs61', 391)" onmouseover="showTip(event, 'fs61', 391)" class="fn">measureCompare</span> <span onmouseout="hideTip(event, 'fs116', 392)" onmouseover="showTip(event, 'fs116', 392)" class="id">garbageMeasure</span> <span onmouseout="hideTip(event, 'fs121', 393)" onmouseover="showTip(event, 'fs121', 393)" class="fn">f1</span> <span onmouseout="hideTip(event, 'fs122', 394)" onmouseover="showTip(event, 'fs122', 394)" class="fn">f2</span>
</code></pre>
<h2><a name="Conclusion" class="anchor" href="#Conclusion">Conclusion</a></h2>
<p>The performance testing functions have a very simple signature.
The statistics functions just take the function to be measured.
The compare functions just take the two functions to be compared.</p>
<p>The statistics functions give an overview of a function's performance.
These can easily be combined to produce a useful performance report.</p>
<p>The compare functions can be used in unit tests since they are a relative test and hence should be independent of the machine.
They are also fast since they stop as soon as the given confidence level is achieved.
The compare functions could also be extended to test if a function is a given percentage better than another.</p>
<p>Modularity from higher-order functions and lazy evaluation together with a little maths have produced a simple yet powerful performance testing library.</p>
<p>UPDATED (2016-10-21):
The functions have been extended to be able to measure a subfunction of the passed in functions.
This enables set up to be done without effecting the measurement.
The subfunction can be called multiple times and the metric will be aggregated.
An example of its use can be found in the Outliers and MAD <a href="{% post_url 2016-10-21-MAD-Outliers %}">post</a>.</p>
<p>UPDATED (2017-01-03):
Performance testing functionality has been added to the F# testing library <a href="https://github.com/haf/expecto">Expecto</a> using the code in this post.</p>


<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Diagnostics</div>
<div class="tip" id="fs3">Multiple items<br />type AutoOpenAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; AutoOpenAttribute<br />&#160;&#160;new : path:string -&gt; AutoOpenAttribute<br />&#160;&#160;member Path : string<br /><br />--------------------<br />new : unit -&gt; AutoOpenAttribute<br />new : path:string -&gt; AutoOpenAttribute</div>
<div class="tip" id="fs4">val sqr : x:&#39;a -&gt; &#39;b (requires member ( * ))</div>
<div class="tip" id="fs5">val x : &#39;a (requires member ( * ))</div>
<div class="tip" id="fs6">SampleStatistics.N: int</div>
<div class="tip" id="fs7">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />--------------------<br />type int = int32<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int</div>
<div class="tip" id="fs8">SampleStatistics.Mean: float</div>
<div class="tip" id="fs9">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />--------------------<br />type float = Double<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float</div>
<div class="tip" id="fs10">SampleStatistics.Variance: float</div>
<div class="tip" id="fs11">val s : SampleStatistics</div>
<div class="tip" id="fs12">val sqrt : value:&#39;T -&gt; &#39;U (requires member Sqrt)</div>
<div class="tip" id="fs13">type WelchStatistic =<br />&#160;&#160;{T: float;<br />&#160;&#160;&#160;DF: int;}</div>
<div class="tip" id="fs14">WelchStatistic.T: float</div>
<div class="tip" id="fs15">WelchStatistic.DF: int</div>
<div class="tip" id="fs16">val sampleStatistics : s:seq&lt;&#39;a&gt; -&gt; seq&lt;SampleStatistics&gt; (requires member op_Explicit)<br /><em><br /><br />&#160;Online statistics sequence for a given sample sequence.</em></div>
<div class="tip" id="fs17">val s : seq&lt;&#39;a&gt; (requires member op_Explicit)</div>
<div class="tip" id="fs18">val calc : (int * float * float -&gt; float -&gt; int * float * float)</div>
<div class="tip" id="fs19">val n : int</div>
<div class="tip" id="fs20">val m : float</div>
<div class="tip" id="fs21">val s : float</div>
<div class="tip" id="fs22">val x : float</div>
<div class="tip" id="fs23">val m&#39; : float</div>
<div class="tip" id="fs24">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs25">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;</div>
<div class="tip" id="fs26">val scan : folder:(&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state:&#39;State -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;State&gt;</div>
<div class="tip" id="fs27">val skip : count:int -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;</div>
<div class="tip" id="fs28">val scale : f:float -&gt; s:SampleStatistics -&gt; SampleStatistics<br /><em><br /><br />&#160;Scale the statistics for a given underlying random variable change of scale.</em></div>
<div class="tip" id="fs29">val f : float</div>
<div class="tip" id="fs30">val singleIteration : ic:int -&gt; s:SampleStatistics -&gt; SampleStatistics<br /><em><br /><br />&#160;Single iteration statistics for a given iteration count and total statistics.</em></div>
<div class="tip" id="fs31">val ic : int</div>
<div class="tip" id="fs32">val private tInv : float []<br /><em><br /><br />&#160;Student&#39;s t-distribution inverse for 0.1% confidence level by degrees of freedom.</em></div>
<div class="tip" id="fs33">val welchStatistic : s1:SampleStatistics -&gt; s2:SampleStatistics -&gt; WelchStatistic<br /><em><br /><br />&#160;Welch&#39;s t-test statistic for two given sample statistics.</em></div>
<div class="tip" id="fs34">val s1 : SampleStatistics</div>
<div class="tip" id="fs35">val s2 : SampleStatistics</div>
<div class="tip" id="fs36">val f1 : float</div>
<div class="tip" id="fs37">val f2 : float</div>
<div class="tip" id="fs38">val welchTest : w:WelchStatistic -&gt; int<br /><em><br /><br />&#160;Welch&#39;s t-test for a given Welch statistic to a confidence level of 0.1%.</em></div>
<div class="tip" id="fs39">val w : WelchStatistic</div>
<div class="tip" id="fs40">val abs : value:&#39;T -&gt; &#39;T (requires member Abs)</div>
<div class="tip" id="fs41">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : [&lt;ParamArray&gt;] indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...</div>
<div class="tip" id="fs42">val get : array:&#39;T [] -&gt; index:int -&gt; &#39;T</div>
<div class="tip" id="fs43">val min : e1:&#39;T -&gt; e2:&#39;T -&gt; &#39;T (requires comparison)</div>
<div class="tip" id="fs44">val length : array:&#39;T [] -&gt; int</div>
<div class="tip" id="fs45">val sign : value:&#39;T -&gt; int (requires member get_Sign)</div>
<div class="tip" id="fs46">module Statistics<br /><br />from Main</div>
<div class="tip" id="fs47">module Performance<br /><br />from Main</div>
<div class="tip" id="fs48">val private targetIterationCount : metric:(int -&gt; &#39;a -&gt; &#39;b) -&gt; metricTarget:&#39;b -&gt; f:&#39;a -&gt; int (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)<br /><em><br /><br />&#160;Find the iteration count to get to at least the metric target.</em></div>
<div class="tip" id="fs49">val metric : (int -&gt; &#39;a -&gt; &#39;b) (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)</div>
<div class="tip" id="fs50">val metricTarget : &#39;b (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)</div>
<div class="tip" id="fs51">val f : &#39;a</div>
<div class="tip" id="fs52">val find : (int -&gt; int)</div>
<div class="tip" id="fs53">val item : &#39;b (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)</div>
<div class="tip" id="fs54">val private measureStatistics : metric:(int -&gt; &#39;a -&gt; &#39;b) * metricTarget:&#39;b -&gt; relativeError:float -&gt; f:&#39;a -&gt; SampleStatistics (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit and member op_Explicit)<br /><em><br /><br />&#160;Create and iterate a statistics sequence for a metric until the given accuracy.</em></div>
<div class="tip" id="fs55">val metric : (int -&gt; &#39;a -&gt; &#39;b) (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit and member op_Explicit)</div>
<div class="tip" id="fs56">val metricTarget : &#39;b (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit and member op_Explicit)</div>
<div class="tip" id="fs57">val relativeError : float</div>
<div class="tip" id="fs58">val initInfinite : initializer:(int -&gt; &#39;T) -&gt; seq&lt;&#39;T&gt;</div>
<div class="tip" id="fs59">val find : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;T</div>
<div class="tip" id="fs60">property SampleStatistics.MeanStandardError: float</div>
<div class="tip" id="fs61">val private measureCompare : metric:(int -&gt; ((&#39;a -&gt; &#39;a) -&gt; &#39;b) -&gt; &#39;c) * metricTarget:&#39;c -&gt; f1:((&#39;a -&gt; &#39;a) -&gt; &#39;b) -&gt; f2:((&#39;a -&gt; &#39;a) -&gt; &#39;b) -&gt; int (requires equality and member ( &lt;&lt;&lt; ) and comparison and member op_Explicit and member op_Explicit)<br /><em><br /><br />&#160;Create and iterate two statistics sequences until the metric means can be compared.</em></div>
<div class="tip" id="fs62">val metric : (int -&gt; ((&#39;a -&gt; &#39;a) -&gt; &#39;b) -&gt; &#39;c) (requires equality and member ( &lt;&lt;&lt; ) and comparison and member op_Explicit and member op_Explicit)</div>
<div class="tip" id="fs63">val metricTarget : &#39;c (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit and member op_Explicit)</div>
<div class="tip" id="fs64">val f1 : ((&#39;a -&gt; &#39;a) -&gt; &#39;b) (requires equality)</div>
<div class="tip" id="fs65">val f2 : ((&#39;a -&gt; &#39;a) -&gt; &#39;b) (requires equality)</div>
<div class="tip" id="fs66">val id : x:&#39;T -&gt; &#39;T</div>
<div class="tip" id="fs67">val failwith : message:string -&gt; &#39;T</div>
<div class="tip" id="fs68">val stats : (((&#39;a -&gt; &#39;a) -&gt; &#39;b) -&gt; seq&lt;SampleStatistics&gt;) (requires equality)</div>
<div class="tip" id="fs69">val f : ((&#39;a -&gt; &#39;a) -&gt; &#39;b) (requires equality)</div>
<div class="tip" id="fs70">val map2 : mapping:(&#39;T1 -&gt; &#39;T2 -&gt; &#39;U) -&gt; source1:seq&lt;&#39;T1&gt; -&gt; source2:seq&lt;&#39;T2&gt; -&gt; seq&lt;&#39;U&gt;</div>
<div class="tip" id="fs71">val pick : chooser:(&#39;T -&gt; &#39;U option) -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;U</div>
<div class="tip" id="fs72">val maxDF : int</div>
<div class="tip" id="fs73">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs74">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs75">val c : int</div>
<div class="tip" id="fs76">val private measureMetric : startMetric:(unit -&gt; &#39;a) -&gt; endMetric:(&#39;a -&gt; &#39;b) -&gt; ic:int -&gt; f:(((&#39;d -&gt; &#39;e) -&gt; &#39;d -&gt; &#39;e) -&gt; &#39;f) -&gt; &#39;c (requires member ( + ) and member get_Zero)<br /><em><br /><br />&#160;Measure the given function for the iteration count using the start and end metric.</em></div>
<div class="tip" id="fs77">val startMetric : (unit -&gt; &#39;a)</div>
<div class="tip" id="fs78">val endMetric : (&#39;a -&gt; &#39;b) (requires member ( + ) and member get_Zero)</div>
<div class="tip" id="fs79">val f : (((&#39;d -&gt; &#39;e) -&gt; &#39;d -&gt; &#39;e) -&gt; &#39;f)</div>
<div class="tip" id="fs80">type GC =<br />&#160;&#160;static member AddMemoryPressure : bytesAllocated:int64 -&gt; unit<br />&#160;&#160;static member CancelFullGCNotification : unit -&gt; unit<br />&#160;&#160;static member Collect : unit -&gt; unit + 4 overloads<br />&#160;&#160;static member CollectionCount : generation:int -&gt; int<br />&#160;&#160;static member EndNoGCRegion : unit -&gt; unit<br />&#160;&#160;static member GetGeneration : obj:obj -&gt; int + 1 overload<br />&#160;&#160;static member GetTotalMemory : forceFullCollection:bool -&gt; int64<br />&#160;&#160;static member KeepAlive : obj:obj -&gt; unit<br />&#160;&#160;static member MaxGeneration : int<br />&#160;&#160;static member ReRegisterForFinalize : obj:obj -&gt; unit<br />&#160;&#160;...</div>
<div class="tip" id="fs81">GC.Collect() : unit<br />GC.Collect(generation: int) : unit<br />GC.Collect(generation: int, mode: GCCollectionMode) : unit<br />GC.Collect(generation: int, mode: GCCollectionMode, blocking: bool) : unit<br />GC.Collect(generation: int, mode: GCCollectionMode, blocking: bool, compacting: bool) : unit</div>
<div class="tip" id="fs82">GC.WaitForPendingFinalizers() : unit</div>
<div class="tip" id="fs83">val mutable total : &#39;c (requires member get_Zero and member ( + ))</div>
<div class="tip" id="fs84">module LanguagePrimitives<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs85">val GenericZero&lt;&#39;T (requires member get_Zero)&gt; : &#39;T (requires member get_Zero)</div>
<div class="tip" id="fs86">val measurer : ((&#39;g -&gt; &#39;h) -&gt; &#39;g -&gt; &#39;h)</div>
<div class="tip" id="fs87">val toMeasure : (&#39;g -&gt; &#39;h)</div>
<div class="tip" id="fs88">val args : &#39;g</div>
<div class="tip" id="fs89">val s : &#39;a</div>
<div class="tip" id="fs90">val ret : &#39;h</div>
<div class="tip" id="fs91">val m : &#39;b (requires member ( + ) and member get_Zero)</div>
<div class="tip" id="fs92">val loop : (int -&gt; unit)</div>
<div class="tip" id="fs93">val i : int</div>
<div class="tip" id="fs94">val ignore : value:&#39;T -&gt; unit</div>
<div class="tip" id="fs95">val private timeMetric : ic:int -&gt; f:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int64<br /><em><br /><br />&#160;Measure the time metric for the given function and iteration count.</em></div>
<div class="tip" id="fs96">val f : (((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c)</div>
<div class="tip" id="fs97">Multiple items<br />type Stopwatch =<br />&#160;&#160;new : unit -&gt; Stopwatch<br />&#160;&#160;member Elapsed : TimeSpan<br />&#160;&#160;member ElapsedMilliseconds : int64<br />&#160;&#160;member ElapsedTicks : int64<br />&#160;&#160;member IsRunning : bool<br />&#160;&#160;member Reset : unit -&gt; unit<br />&#160;&#160;member Restart : unit -&gt; unit<br />&#160;&#160;member Start : unit -&gt; unit<br />&#160;&#160;member Stop : unit -&gt; unit<br />&#160;&#160;static val Frequency : int64<br />&#160;&#160;...<br /><br />--------------------<br />Stopwatch() : Stopwatch</div>
<div class="tip" id="fs98">Stopwatch.GetTimestamp() : int64</div>
<div class="tip" id="fs99">val t : int64</div>
<div class="tip" id="fs100">val private memoryMetric : ic:int -&gt; f:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int64<br /><em><br /><br />&#160;Measure the memory metric for the given function and iteration count.</em></div>
<div class="tip" id="fs101">val startMetric : (unit -&gt; int64)</div>
<div class="tip" id="fs102">GC.TryStartNoGCRegion(totalSize: int64) : bool<br />GC.TryStartNoGCRegion(totalSize: int64, disallowFullBlockingGC: bool) : bool<br />GC.TryStartNoGCRegion(totalSize: int64, lohSize: int64) : bool<br />GC.TryStartNoGCRegion(totalSize: int64, lohSize: int64, disallowFullBlockingGC: bool) : bool</div>
<div class="tip" id="fs103">val not : value:bool -&gt; bool</div>
<div class="tip" id="fs104">GC.GetTotalMemory(forceFullCollection: bool) : int64</div>
<div class="tip" id="fs105">val endMetric : (int64 -&gt; int64)</div>
<div class="tip" id="fs106">val s : int64</div>
<div class="tip" id="fs107">GC.EndNoGCRegion() : unit</div>
<div class="tip" id="fs108">val private garbageMetric : ic:int -&gt; f:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int<br /><em><br /><br />&#160;Measure the garbage collection metric for the given function and iteration count.</em></div>
<div class="tip" id="fs109">val count : (unit -&gt; int)</div>
<div class="tip" id="fs110">GC.CollectionCount(generation: int) : int</div>
<div class="tip" id="fs111">val s : int</div>
<div class="tip" id="fs112">val private oneMillisecond : int64<br /><em><br /><br />&#160;Measure definitions which are a metric together with a metric target.</em></div>
<div class="tip" id="fs113">field Stopwatch.Frequency: int64</div>
<div class="tip" id="fs114">val private timeMeasure : (int -&gt; (((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int64) * int64</div>
<div class="tip" id="fs115">val private memoryMeasure : (int -&gt; (((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int64) * int64</div>
<div class="tip" id="fs116">val private garbageMeasure : (int -&gt; (((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int) * int</div>
<div class="tip" id="fs117">val timeStatistics : f:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; SampleStatistics<br /><em><br /><br />&#160;Time statistics for a given function accurate to a mean standard error of 1%.</em></div>
<div class="tip" id="fs118">val memoryStatistics : f:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; SampleStatistics<br /><em><br /><br />&#160;Memory statistics for a given function accurate to a mean standard error of 1%.</em></div>
<div class="tip" id="fs119">val gcCountStatistics : f:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; SampleStatistics<br /><em><br /><br />&#160;GC count statistics for a given function accurate to a mean standard error of 1%.</em></div>
<div class="tip" id="fs120">val timeCompare : f1:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; f2:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int (requires equality)<br /><em><br /><br />&#160;Time comparison for two given functions to a confidence level of 0.1%.</em></div>
<div class="tip" id="fs121">val f1 : (((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) (requires equality)</div>
<div class="tip" id="fs122">val f2 : (((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) (requires equality)</div>
<div class="tip" id="fs123">val memoryCompare : f1:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; f2:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int (requires equality)<br /><em><br /><br />&#160;Memory comparison for two given functions to a confidence level of 0.1%.</em></div>
<div class="tip" id="fs124">val gcCountCompare : f1:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; f2:(((&#39;a -&gt; &#39;b) -&gt; &#39;a -&gt; &#39;b) -&gt; &#39;c) -&gt; int (requires equality)<br /><em><br /><br />&#160;GC count comparison for two given functions to a confidence level of 0.1%.</em></div>
