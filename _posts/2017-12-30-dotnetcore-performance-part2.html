---
layout: post
title: ".Net Core 2.0 Performance Notes Revisited"
tags: [dotnetcore,dotnet,fsharp,performance,benchmarks]
description: "Benchmarks Game .Net Core 2.0 Performance Notes Revisited"
keywords: C#, F#, dotnet, dotnetcore, performance, benchmarks
---
<p>This post is part of the <a href="https://sergeytihon.com/2017/10/22/f-advent-calendar-in-english-2017/">F# Advent Calendar 2017</a> series.
Many thanks to Sergey Tihon for organizing these.</p>
<p>Over the past few weeks I've been submitting improvements to some of the F# programs in the <a href="http://benchmarksgame.alioth.debian.org/">Benchmarks Game</a>.
In a previous <a href="{% post_url 2017-08-15-dotnetcore-performance %}">post</a> I did this for the C# programs.</p>
<p>Since that post things have moved on and C# is currently faster than Java for 8 out of 10 of the programs.
Java is faster for <code>regex-redux</code> as .Net Core doesn't yet have a compiled regex implementation.
For <code>k-nucleotide</code> Java makes use of a dictionary well suited to the program not available to C#.</p>
<p>Most of the submissions to the F# programs were ports of the C# code that had recently been optimised.
For <code>fasta</code> and <code>k-nucleotide</code> further optimisations were discovered.
<code>ArrayPool</code> is very useful in the case of <code>fasta</code>.
For <code>k-nucleotide</code> the largest dictionary can be constructed more efficiently in four parallel parts.</p>
<p>Another tempting optimisation was in F# there is a one to one replacement to use native pointers for array access e.g. <code>Array.get a i</code> becomes <code>NativePtr.get a i</code>.
This actually only provided a small improvement in most cases.</p>
<h2>Results</h2>
<p><a href="http://benchmarksgame.alioth.debian.org/u64q/csharp.html">C# vs Java</a>, <a href="http://benchmarksgame.alioth.debian.org/u64q/compare.php?lang=fsharpcore&amp;lang2=csharpcore">F# vs C#</a>, <a href="http://benchmarksgame.alioth.debian.org/u64q/compare.php?lang=fsharpcore&amp;lang2=java">F# vs Java</a>, <a href="http://benchmarksgame.alioth.debian.org/u64q/compare.php?lang=fsharpcore&amp;lang2=ghc">F# vs Haskell</a>, <a href="http://benchmarksgame.alioth.debian.org/u64q/fsharp.html">F# vs OCaml</a>, <a href="http://benchmarksgame.alioth.debian.org/u64q/compare.php?lang=fsharpcore&amp;lang2=python3">F# vs Python</a></p>
<table>
<thead>
<tr class="header">
<th align="left"><p>Program</p></th>
<th align="right"><p>C#</p></th>
<th align="right"><p>F#</p></th>
<th align="right"><p>Java</p></th>
<th align="right"><p>Haskell</p></th>
<th align="right"><p>OCaml</p></th>
<th align="right"><p>Python</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>

<p>| pidigits           |   <strong>3.03</strong>  |   3.05  |   3.12  |  Error  |  Error  |   3.43  |
| reverse-complement |   <strong>0.78</strong>  |   0.82  |   1.03  |   1.40  |   0.79  |   3.26  |
| n-body             |  <strong>21.37</strong>  |  22.86  |  22.10  |  21.43  |  21.67  | 838.39  |
| mandelbrot         |   <strong>5.83</strong>  |   6.66  |   6.04  |  11.69  |  55.18  | 225.24  |
| fannkuch-redux     |  <strong>14.44</strong>  |  16.65  |  17.26  |  15.40  |  16.12  | 565.97  |
| binary-trees       |   <strong>8.26</strong>  |   8.54  |   8.34  |  23.66  |  10.03  |  93.55  |
| fasta              |   2.09  |   <strong>1.67</strong>  |   2.33  |   9.36  |   6.00  |  59.47  |
| k-nucleotide       |  11.47  |  10.43  |   <strong>8.70</strong>  |  35.01  |  21.63  |  77.65  |
| regex-redux        |  30.74  |  31.02  |  <strong>10.34</strong>  |  Error  |  24.66  |  15.22  |
| spectral-norm      |   4.07  |   4.22  |   4.23  |   <strong>4.04</strong>  |   4.31  | 180.97  |</p>
<h2>Conclusion</h2>
<p>Usual caveats of current state.</p>
<p>vs C# 15% C# is very good
vs Java good 5/5 means vs Scala would be v good.
vs other functional v good.
.Net Core stunning perf.</p>
<p>I feel I have to plug <a href="https://github.com/haf/expecto#performance-module">Expect.isFasterThan</a> in Expecto.
It has proved to be a quick way of checking that one implementation is truely faster than another.</p>
<p><img src="/{{site.baseurl}}public/perf/half-is-faster.png" alt="isFasterThan" /></p>


