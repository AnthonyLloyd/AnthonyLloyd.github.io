---
layout: post
title: "Get MAD with Outliers with an improved Median function"
tags: [MAD,median,outlier,statistics]
description: ""
keywords: median absolute deviation, MAD, median, outlier, statistics
---
<p>This post presents a more robust method of detecting outliers in sample data than commonly used.
The method is based on the median and an optimised F# median function is provided.</p>
<h2>Background</h2>
<p><a href="https://www.researchgate.net/publication/256752600_Detecting_outliers_Do_not_use_standard_deviation_around_the_mean_use_absolute_deviation_around_the_median">Researchers</a> most commonly use standard deviation around the mean to detect outliers.
This is a problem because the mean and standard deviation give greater weight to extreme data points.</p>
<p>The mean is the point that minimises the sum of the square deviations, whereas the median is the point that minimises the sum of the absolute deviations.
The median and <a href="https://en.wikipedia.org/wiki/Median_absolute_deviation">median absolute deviation</a> give a more robust measure of statistical dispersion and are more resilient to outliers.</p>
<p>When a politician says average wages are increasing be sure to check the median is being reported.</p>
<h2>Statistics</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Median">median</a> is the value separating the higher half of the sample from the lower half of the sample.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Median_absolute_deviation">median absolute deviation</a> is defined as</p>
<p><span class="math">\[\operatorname{MAD} = \operatorname{median}\left(\left|x_i - \operatorname{median}(x_i)\right|\right)\]</span></p>
<p>Outliers can be identified as points that are outside a fixed multiple of median absolute deviation from the median. Recommended values for this multiple are 2.5 or 3.</p>
<h2>Median and MAD functions</h2>
<p>The following median function makes use the <a href="http://dhost.info/zabrodskyvlada/algor.html">MODIFIND</a> algorithm by Vladimir Zabrodsky.
It provides a 20-30% performance improvement over the <a href="https://en.wikipedia.org/wiki/Quickselect">Quickselect</a> algorithm.
In addition I have added features to improve the performance when the data has a high degree of duplicate or sorting.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span class="t">Statistics</span> <span class="o">=</span>
    <span class="c">/// Returns the median of the sample array.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="f">medianInplace</span> (<span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">a</span><span class="o">:</span>_[]) <span class="o">=</span> <span class="n">1.0</span>
</code></pre></td>
</tr>
</table>
<h2>Property and Performance testing</h2>
<p>I compared the performance against a full sort and the Math.Net C# Quickselect implimentation.
This uses the performance testing library provided in a previous <a href="{% post_url 2016-05-20-performance-testing %}">post</a>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="t">StatisticsTests</span> <span class="o">=</span>
    <span class="c">/// Returns the median of an array.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="f">medianInplaceTest</span>() <span class="o">=</span> ()
</code></pre></td>
</tr>
</table>
<p>Table.</p>
<h2>Conclusion</h2>
<p>Todo.</p>


<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Diagnostics</div>
<div class="tip" id="fs3">Multiple items<br />type AutoOpenAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; AutoOpenAttribute<br />&#160;&#160;new : path:string -&gt; AutoOpenAttribute<br />&#160;&#160;member Path : string<br /><br />Full name: Microsoft.FSharp.Core.AutoOpenAttribute<br /><br />--------------------<br />new : unit -&gt; AutoOpenAttribute<br />new : path:string -&gt; AutoOpenAttribute</div>
<div class="tip" id="fs4">val sqr : x:&#39;a -&gt; &#39;b (requires member ( * ))<br /><br />Full name: Main.Functions.sqr</div>
<div class="tip" id="fs5">val x : &#39;a (requires member ( * ))</div>
<div class="tip" id="fs6">val medianInplace : a:&#39;a [] -&gt; float<br /><br />Full name: Main.Statistics.medianInplace<br /><em><br /><br />&#160;Returns the median of the sample array.</em></div>
<div class="tip" id="fs7">val a : &#39;a []</div>
<div class="tip" id="fs8">module StatisticsTests<br /><br />from Main</div>
<div class="tip" id="fs9">val medianInplaceTest : unit -&gt; unit<br /><br />Full name: Main.StatisticsTests.medianInplaceTest<br /><em><br /><br />&#160;Returns the median of an array.</em></div>
