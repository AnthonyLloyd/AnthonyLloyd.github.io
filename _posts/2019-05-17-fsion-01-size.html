---
layout: post
title: "Fsion - Size"
tags: [f#,fsion,database,timeseries]
description: "Fsion - Size"
keywords: F#, fsion, database, timeseries
exclude: true
---
<p>The sample data set is around 10 months of daily position files for the 280
<a href="https://www.ishares.com/uk/intermediaries/en/products/etf-product-list#!type=emeaIshares&amp;tab=overview&amp;view=list">iShares</a>
funds available online.
All fields in the files are loaded apart from any that can be calculated.</p>
<p>Funds: 280<br />
Days: 206<br />
Position files: 71,261<br />
Size unzipped: 4.4GB<br />
Size .zip normal: 1.1GB<br />
Size .7z ultra: 199MB</p>
<h2>DataSeries compression</h2>
<p>DataSeries represent an ordered table of Date, Transaction Id and <code>int64</code> Encoded Values
with the latest values at the the top.</p>
<p>This is encoded as a byte array.
Each row is stored as a difference to the above field values as <a href="https://developers.google.com/protocol-buffers/docs/encoding">varints</a>.</p>
<p>Since the table is ordered, and the values in each row are very likely to be close to the ones above, very high compression ratios are possible.</p>
<h2>Data details</h2>
<p>Text values are stored in a <code>SetSlim&lt;Text&gt;</code> collection, numeric values are encoded directly to <code>int64</code>.
The DataSeries are stored in a <code>MapSlim&lt;EntityAttribute,DataSeries&gt;</code>.</p>
<p>Text: Count = 59,099 Max length = 50</p>
<table>
<thead>
<tr class="header">
<th align="center"><p>Count<br/>Bytes</p></th>
<th align="center"><p>transaction</p></th>
<th align="center"><p>entitytype</p></th>
<th align="center"><p>attribute</p></th>
<th align="center"><p>instrument</p></th>
<th align="center"><p>position</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><p>uri</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>name</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>5<br/>15</p></td>
<td align="center"><p>20<br/>60</p></td>
<td align="center"><p>38,036<br/>279,391</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>time</p></td>
<td align="center"><p>71,262<br/>909,886</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>attribute_type</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>20<br/>60</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>attribute_isset</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>isin</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>36,476<br/>273,162</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>ticker</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>38,036<br/>275,050</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>currency</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>38,036<br/>240,802</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>assetclass</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>38,023<br/>261,032</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>sector</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>37,927<br/>258,075</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>exchange</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>12,046<br/>79,467</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>country</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>38,036<br/>267,549</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>coupon</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>25,552<br/>193,815</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>maturity</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>25,546<br/>205,849</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>price</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>38,036<br/>15,846,249</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="even">
<td align="center"><p>duration</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>25,552<br/>5,740,430</p></td>
<td align="center"><p>0<br/>0</p></td>
</tr>
<tr class="odd">
<td align="center"><p>fund</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>147,323<br/>1,184,564</p></td>
</tr>
<tr class="even">
<td align="center"><p>instrument</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>147,323<br/>1,096,271</p></td>
</tr>
<tr class="odd">
<td align="center"><p>nominal</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>0<br/>0</p></td>
<td align="center"><p>147,323<br/>8,306,493</p></td>
</tr>
</tbody>
</table>

<h2>Size Estimates</h2>
<p>Memory 32-bit: Text = 3,028,394 Data = 64,364,789 Total = 67,393,183<br />
Memory 64-bit: Text = 3,974,002 Data = 78,838,077 Total = 82,812,079<br />
Size on disk = 42,348,255</p>
<img src="/{{site.baseurl}}public/fsion/size-by-files.png" title="size by files" />
<p>Extrapolating these curves to 10 years of files would give total memory usage of around 650 MB.
The files contain the key changing attributes.
A database with a number of additional attributes would be expected to comfortably fit in 1 to 5 GB.</p>
<h2>Conclusion</h2>
<p>This is very handy as the database file size is small enough to commit to github and can be used going forward for testing and performance benchmarking.</p>
<p>Looking at the size on disk compared to 32-bit and 64-bit in memory estimates shows that the objects and pointers contribute a large amount to the size.
If the DataSeries were not in a time series compressed format this object and pointer overhead would be a lot higher.
This agrees with what is often found in server caches. Holding and tracking fine grained subsets of the database can actually use a lot of memory.</p>
<p>It also shows the estimates in the <a href="http://anthonylloyd.github.io/blog/2018/02/01/architecture-data-first">Data-First Architecture</a> blog post are too
high as it doesn't take account of the DataSeries compression that is possible.</p>
<p>Next we will look at the performance characteristics of this database compared to other options.</p>


