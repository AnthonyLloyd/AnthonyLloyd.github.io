---
layout: post
title: "F# Elm like UI model"
tags: [Elm,UI]
description: ""
keywords: elm, ui
---
<p>This is the...</p>
<h2>Background</h2>
<p>To performance test code...</p>
<h2>Statistics</h2>
<p>Lazy evaluation can be used to produce an <a href="https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Online_algorithm">online</a> sample statistics sequence.</p>
<h2>Statistics code</h2>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="t">SampleStatistics</span> <span class="o">=</span> {<span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">N</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="t">int</span>;<span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">Mean</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="t">float</span>;<span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="i">Variance</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="t">float</span>}
                        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="i">StandardDeviation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="f">sqrt</span> <span onmouseout="hideTip(event, 'fs9', 14)" onmouseover="showTip(event, 'fs9', 14)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 15)" onmouseover="showTip(event, 'fs8', 15)" class="i">Variance</span>
                        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs9', 16)" onmouseover="showTip(event, 'fs9', 16)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 17)" onmouseover="showTip(event, 'fs12', 17)" class="i">MeanStandardError</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 18)" onmouseover="showTip(event, 'fs11', 18)" class="f">sqrt</span>(<span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 20)" onmouseover="showTip(event, 'fs8', 20)" class="i">Variance</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs7', 21)" onmouseover="showTip(event, 'fs7', 21)" class="f">float</span> <span onmouseout="hideTip(event, 'fs9', 22)" onmouseover="showTip(event, 'fs9', 22)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 23)" onmouseover="showTip(event, 'fs4', 23)" class="i">N</span>)
</code></pre></td>
</tr>
</table>
<h2>Performance testing</h2>
<p>Three ...</p>
<h2>Performance testing code</h2>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span class="t">Performance</span> <span class="o">=</span>
    <span class="c">/// Find the iteration count to get to at least the metric target.</span>
    <span class="k">let</span> <span class="k">inline</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs13', 24)" onmouseover="showTip(event, 'fs13', 24)" class="f">targetIterationCount</span> <span onmouseout="hideTip(event, 'fs14', 25)" onmouseover="showTip(event, 'fs14', 25)" class="f">metric</span> <span onmouseout="hideTip(event, 'fs15', 26)" onmouseover="showTip(event, 'fs15', 26)" class="i">metricTarget</span> <span onmouseout="hideTip(event, 'fs16', 27)" onmouseover="showTip(event, 'fs16', 27)" class="i">f</span> <span class="o">=</span>
        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs17', 28)" onmouseover="showTip(event, 'fs17', 28)" class="f">find</span> <span onmouseout="hideTip(event, 'fs18', 29)" onmouseover="showTip(event, 'fs18', 29)" class="i">n</span> <span class="o">=</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 30)" onmouseover="showTip(event, 'fs19', 30)" class="i">item</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 31)" onmouseover="showTip(event, 'fs14', 31)" class="f">metric</span> <span onmouseout="hideTip(event, 'fs18', 32)" onmouseover="showTip(event, 'fs18', 32)" class="i">n</span> <span onmouseout="hideTip(event, 'fs16', 33)" onmouseover="showTip(event, 'fs16', 33)" class="i">f</span>
            <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs19', 34)" onmouseover="showTip(event, 'fs19', 34)" class="i">item</span><span class="o">&lt;&lt;&lt;</span><span class="n">3</span>)<span class="o">&gt;</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs15', 35)" onmouseover="showTip(event, 'fs15', 35)" class="i">metricTarget</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs18', 36)" onmouseover="showTip(event, 'fs18', 36)" class="i">n</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs5', 37)" onmouseover="showTip(event, 'fs5', 37)" class="f">int</span> <span onmouseout="hideTip(event, 'fs15', 38)" onmouseover="showTip(event, 'fs15', 38)" class="i">metricTarget</span><span class="o">/</span><span onmouseout="hideTip(event, 'fs5', 39)" onmouseover="showTip(event, 'fs5', 39)" class="f">int</span> <span onmouseout="hideTip(event, 'fs19', 40)" onmouseover="showTip(event, 'fs19', 40)" class="i">item</span><span class="o">+</span><span class="n">1</span>
            <span class="k">else</span> <span onmouseout="hideTip(event, 'fs17', 41)" onmouseover="showTip(event, 'fs17', 41)" class="f">find</span> (<span onmouseout="hideTip(event, 'fs18', 42)" onmouseover="showTip(event, 'fs18', 42)" class="i">n</span><span class="o">*</span><span class="n">10</span>)
        <span onmouseout="hideTip(event, 'fs17', 43)" onmouseover="showTip(event, 'fs17', 43)" class="f">find</span> <span class="n">1</span>
        
</code></pre></td>
</tr>
</table>
<h2>Conclusion</h2>
<p>The performance testing functions have a very simple signature.
The statistics functions just take the function to be measured.
The compare functions just take the two functions to be compared.</p>
<p>The statistics functions give an overview of a function's performance.
These can easily be combined to produce a useful performance report.</p>
<p>The compare functions can be used in unit tests since they are a relative test and hence should be independent of the machine.
They are also fast since they stop as soon as the given confidence level is achieved.
The compare functions could also be extended to test if a function is a given percentage better than another.</p>
<p>Modularity from higher-order functions and lazy evaluation together with a little maths have produced a simple yet powerful performance testing library.</p>


<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Diagnostics</div>
<div class="tip" id="fs3">type SampleStatistics =<br />&#160;&#160;{N: int;<br />&#160;&#160;&#160;Mean: float;<br />&#160;&#160;&#160;Variance: float;}<br />&#160;&#160;member MeanStandardError : float<br />&#160;&#160;member StandardDeviation : float<br /><br />Full name: Main.SampleStatistics</div>
<div class="tip" id="fs4">SampleStatistics.N: int</div>
<div class="tip" id="fs5">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs6">SampleStatistics.Mean: float</div>
<div class="tip" id="fs7">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs8">SampleStatistics.Variance: float</div>
<div class="tip" id="fs9">val s : SampleStatistics</div>
<div class="tip" id="fs10">member SampleStatistics.StandardDeviation : float<br /><br />Full name: Main.SampleStatistics.StandardDeviation</div>
<div class="tip" id="fs11">val sqrt : value:&#39;T -&gt; &#39;U (requires member Sqrt)<br /><br />Full name: Microsoft.FSharp.Core.Operators.sqrt</div>
<div class="tip" id="fs12">member SampleStatistics.MeanStandardError : float<br /><br />Full name: Main.SampleStatistics.MeanStandardError</div>
<div class="tip" id="fs13">val private targetIterationCount : metric:(int -&gt; &#39;a -&gt; &#39;b) -&gt; metricTarget:&#39;b -&gt; f:&#39;a -&gt; int (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)<br /><br />Full name: Main.Performance.targetIterationCount<br /><em><br /><br />&#160;Find the iteration count to get to at least the metric target.</em></div>
<div class="tip" id="fs14">val metric : (int -&gt; &#39;a -&gt; &#39;b) (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)</div>
<div class="tip" id="fs15">val metricTarget : &#39;b (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)</div>
<div class="tip" id="fs16">val f : &#39;a</div>
<div class="tip" id="fs17">val find : (int -&gt; int)</div>
<div class="tip" id="fs18">val n : int</div>
<div class="tip" id="fs19">val item : &#39;b (requires member ( &lt;&lt;&lt; ) and comparison and member op_Explicit)</div>
