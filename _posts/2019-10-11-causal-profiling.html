---
layout: post
title: "Causal Profiling in .NET"
tags: [causal,profiling,performance]
description: "Causal Profiling in .NET"
keywords: causal, profiling, performance
exclude: true
---
<p>Recently I saw a great multithreading profiling technique called causal profiling.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/r-TLSBdHe1A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>I decided to see if I could do this in .NET.</p>
<p>It fits well in a debug library that I use as a preference to step through debugging <a href="{% post_url 2017-04-30-kicking-the-debugger %}">Kicking the Debugger habit</a>.</p>
<h2>Simple model</h2>
<p>Causal profiling...<br />
Iterations: 300</p>
<table>
<thead>
<tr class="header">
<th align="left"><p>Region</p></th>
<th align="right"><p>Count</p></th>
<th align="right"><p>Time%</p></th>
<th align="right"><p>+10%</p></th>
<th align="right"><p>+5%</p></th>
<th align="right"><p>-5%</p></th>
<th align="right"><p>-10%</p></th>
<th align="right"><p>-15%</p></th>
<th align="right"><p>-20%</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>rnds</p></td>
<td align="right"><p>1629</p></td>
<td align="right"><p>87.7</p></td>
<td align="right"><p>-2.4 ± 0.5</p></td>
<td align="right"><p>-1.3 ± 0.5</p></td>
<td align="right"><p>1.9 ± 0.6</p></td>
<td align="right"><p>1.7 ± 0.6</p></td>
<td align="right"><p>3.7 ± 0.5</p></td>
<td align="right"><p>4.3 ± 0.6</p></td>
</tr>
<tr class="even">
<td align="left"><p>bytes</p></td>
<td align="right"><p>1627</p></td>
<td align="right"><p>340.3</p></td>
<td align="right"><p>-8.1 ± 0.5</p></td>
<td align="right"><p>-4.4 ± 0.5</p></td>
<td align="right"><p>4.1 ± 0.5</p></td>
<td align="right"><p>7.2 ± 0.6</p></td>
<td align="right"><p>11.7 ± 0.5</p></td>
<td align="right"><p>14.8 ± 0.6</p></td>
</tr>
<tr class="odd">
<td align="left"><p>one</p></td>
<td align="right"><p>1</p></td>
<td align="right"><p>5.4</p></td>
<td align="right"><p>-0.3 ± 0.5</p></td>
<td align="right"><p>-0.4 ± 0.5</p></td>
<td align="right"><p>0.8 ± 0.6</p></td>
<td align="right"><p>0.3 ± 0.6</p></td>
<td align="right"><p>0.3 ± 0.6</p></td>
<td align="right"><p>0.6 ± 0.6</p></td>
</tr>
<tr class="even">
<td align="left"><p>write</p></td>
<td align="right"><p>1630</p></td>
<td align="right"><p>15.1</p></td>
<td align="right"><p>-1.3 ± 0.5</p></td>
<td align="right"><p>-0.8 ± 0.5</p></td>
<td align="right"><p>0.5 ± 0.6</p></td>
<td align="right"><p>-0.4 ± 0.6</p></td>
<td align="right"><p>1.1 ± 0.6</p></td>
<td align="right"><p>1.0 ± 0.6</p></td>
</tr>
</tbody>
</table>

<h2>Faithful model</h2>
<p>Causal profiling...<br />
Iterations: 300</p>
<table>
<thead>
<tr class="header">
<th align="left"><p>Region</p></th>
<th align="right"><p>Count</p></th>
<th align="right"><p>Time%</p></th>
<th align="right"><p>+10%</p></th>
<th align="right"><p>+5%</p></th>
<th align="right"><p>-5%</p></th>
<th align="right"><p>-10%</p></th>
<th align="right"><p>-15%</p></th>
<th align="right"><p>-20%</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>rnds</p></td>
<td align="right"><p>1629</p></td>
<td align="right"><p>87.7</p></td>
<td align="right"><p>-2.7 ± 0.6</p></td>
<td align="right"><p>-1.1 ± 0.5</p></td>
<td align="right"><p>0.1 ± 0.5</p></td>
<td align="right"><p>1.6 ± 0.5</p></td>
<td align="right"><p>2.7 ± 0.5</p></td>
<td align="right"><p>3.9 ± 0.5</p></td>
</tr>
<tr class="even">
<td align="left"><p>bytes</p></td>
<td align="right"><p>1627</p></td>
<td align="right"><p>286.6</p></td>
<td align="right"><p>-7.9 ± 0.5</p></td>
<td align="right"><p>-4.3 ± 0.5</p></td>
<td align="right"><p>2.7 ± 0.5</p></td>
<td align="right"><p>6.7 ± 0.5</p></td>
<td align="right"><p>9.3 ± 0.5</p></td>
<td align="right"><p>12.8 ± 0.5</p></td>
</tr>
<tr class="odd">
<td align="left"><p>one</p></td>
<td align="right"><p>1</p></td>
<td align="right"><p>6.7</p></td>
<td align="right"><p>-0.5 ± 0.5</p></td>
<td align="right"><p>-0.2 ± 0.5</p></td>
<td align="right"><p>-0.3 ± 0.5</p></td>
<td align="right"><p>0.4 ± 0.5</p></td>
<td align="right"><p>0.2 ± 0.5</p></td>
<td align="right"><p>0.3 ± 0.5</p></td>
</tr>
<tr class="even">
<td align="left"><p>write</p></td>
<td align="right"><p>1630</p></td>
<td align="right"><p>16.9</p></td>
<td align="right"><p>-1.0 ± 0.5</p></td>
<td align="right"><p>-0.7 ± 0.5</p></td>
<td align="right"><p>-0.3 ± 0.5</p></td>
<td align="right"><p>0.3 ± 0.5</p></td>
<td align="right"><p>0.5 ± 0.5</p></td>
<td align="right"><p>0.8 ± 0.5</p></td>
</tr>
</tbody>
</table>

<h2>Conclusion</h2>
<p>Well not so much of a conclusion as more of a question.<br />
What do we think simple or faithful?<br />
I may not be fully appreciating why the faithful model represents reducing a region.</p>


