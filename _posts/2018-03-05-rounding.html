---
layout: post
title: "Rounding Algorithms from Property Based Testing"
tags: [rounding,testing,property,based]
description: "Rounding Algorithms from Property Based Testing"
keywords: f#, rounding, testing, property, based
---
<p>Steffen Forkmann recently posted a <a href="http://www.navision-blog.de/blog/2018/02/21/rounding-is-a-bitch/">blog</a> about incorrect rounding in a twitter poll, and how coding a rounding strategy is a hard problem.
This got me thinking about how many correct rounding algorithms there are.</p>
<p>In these type of problems it is important to look at what properties the algorithm should have.
Property based testing is a great tool when doing this.</p>
<p>The key property required for a fair rounding algorithm is that rounded values increase with the weights.
It doesn't make sense for a lower weight to have a greater rounded value.
Symmetry in the results for negative weights and negative value to be distributed are also important.
This can easily be achieved by mapping from the positive results, but a robust algorithm shouldn't need to do this.</p>
<p>In the blog it was proposed that adjusting the largest weight would work, but in general this can only work when the rounding needs a positive adjustment due to the increasing with weight property.
For negative adjustments the smallest non-zero weight would need to be adjusted.
It may also be unfair to adjust these values if they already have a large rounding error.</p>
<h2><a name="Error-minimisation-algorithm" class="anchor" href="#Error-minimisation-algorithm">Error minimisation algorithm</a></h2>
<p>This algorithm minimises the absolute and relative rounding errors.
I normally apply absolute then relative but the reverse order also works and may be more correct for certain problems.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Distribute integer n over an array of weights</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="fn">distribute</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="id">n</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="id">weights</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="id">wt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="id">sum</span> <span onmouseout="hideTip(event, 'fs5', 9)" onmouseover="showTip(event, 'fs5', 9)" class="id">weights</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="id">isEmpty</span> <span onmouseout="hideTip(event, 'fs5', 12)" onmouseover="showTip(event, 'fs5', 12)" class="id">weights</span>
        <span class="o">||</span> <span onmouseout="hideTip(event, 'fs10', 13)" onmouseover="showTip(event, 'fs10', 13)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="id">maxBy</span> <span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="fn">abs</span> <span onmouseout="hideTip(event, 'fs5', 16)" onmouseover="showTip(event, 'fs5', 16)" class="id">weights</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs13', 17)" onmouseover="showTip(event, 'fs13', 17)" class="fn">float</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs12', 18)" onmouseover="showTip(event, 'fs12', 18)" class="fn">abs</span> <span onmouseout="hideTip(event, 'fs4', 19)" onmouseover="showTip(event, 'fs4', 19)" class="id">n</span><span class="o">+</span><span class="n">1</span><span class="pn">)</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="fn">abs</span>
           <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 21)" onmouseover="showTip(event, 'fs12', 21)" class="fn">abs</span> <span onmouseout="hideTip(event, 'fs6', 22)" onmouseover="showTip(event, 'fs6', 22)" class="id">wt</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs13', 23)" onmouseover="showTip(event, 'fs13', 23)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs14', 24)" onmouseover="showTip(event, 'fs14', 24)" class="vt">Int32</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs15', 25)" onmouseover="showTip(event, 'fs15', 25)" class="id">MaxValue</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="uc">None</span>
    <span class="k">else</span>
        <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs17', 27)" onmouseover="showTip(event, 'fs17', 27)" class="fn">round</span> <span onmouseout="hideTip(event, 'fs18', 28)" onmouseover="showTip(event, 'fs18', 28)" class="id">f</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 29)" onmouseover="showTip(event, 'fs19', 29)" class="fn">int</span><span class="pn">(</span><span class="k">if</span> <span onmouseout="hideTip(event, 'fs18', 30)" onmouseover="showTip(event, 'fs18', 30)" class="id">f</span><span class="o">&lt;</span><span class="n">0.0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs18', 31)" onmouseover="showTip(event, 'fs18', 31)" class="id">f</span><span class="o">-</span><span class="n">0.5</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs18', 32)" onmouseover="showTip(event, 'fs18', 32)" class="id">f</span><span class="o">+</span><span class="n">0.5</span><span class="pn">)</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 33)" onmouseover="showTip(event, 'fs20', 33)" class="id">ns</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 34)" onmouseover="showTip(event, 'fs7', 34)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs21', 35)" onmouseover="showTip(event, 'fs21', 35)" class="id">map</span> <span class="pn">(</span><span class="o">(*)</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs13', 36)" onmouseover="showTip(event, 'fs13', 36)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs4', 37)" onmouseover="showTip(event, 'fs4', 37)" class="id">n</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs6', 38)" onmouseover="showTip(event, 'fs6', 38)" class="id">wt</span><span class="pn">)</span> <span class="o">&gt;</span><span class="pn">&gt;</span> <span onmouseout="hideTip(event, 'fs17', 39)" onmouseover="showTip(event, 'fs17', 39)" class="fn">round</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs5', 40)" onmouseover="showTip(event, 'fs5', 40)" class="id">weights</span>

        <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs22', 41)" onmouseover="showTip(event, 'fs22', 41)" class="fn">absoluteError</span> <span onmouseout="hideTip(event, 'fs23', 42)" onmouseover="showTip(event, 'fs23', 42)" class="id">wi</span> <span onmouseout="hideTip(event, 'fs24', 43)" onmouseover="showTip(event, 'fs24', 43)" class="id">ni</span> <span onmouseout="hideTip(event, 'fs25', 44)" onmouseover="showTip(event, 'fs25', 44)" class="id">d</span> <span class="o">=</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 45)" onmouseover="showTip(event, 'fs26', 45)" class="id">wc</span> <span class="o">=</span> <span class="n">0.5</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs13', 46)" onmouseover="showTip(event, 'fs13', 46)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs25', 47)" onmouseover="showTip(event, 'fs25', 47)" class="id">d</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs6', 48)" onmouseover="showTip(event, 'fs6', 48)" class="id">wt</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs13', 49)" onmouseover="showTip(event, 'fs13', 49)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs4', 50)" onmouseover="showTip(event, 'fs4', 50)" class="id">n</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 51)" onmouseover="showTip(event, 'fs27', 51)" class="id">wni</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 52)" onmouseover="showTip(event, 'fs13', 52)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs24', 53)" onmouseover="showTip(event, 'fs24', 53)" class="id">ni</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs6', 54)" onmouseover="showTip(event, 'fs6', 54)" class="id">wt</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs13', 55)" onmouseover="showTip(event, 'fs13', 55)" class="fn">float</span> <span onmouseout="hideTip(event, 'fs4', 56)" onmouseover="showTip(event, 'fs4', 56)" class="id">n</span>
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs26', 57)" onmouseover="showTip(event, 'fs26', 57)" class="id">wc</span> <span class="o">&gt;</span> <span class="n">0.0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs28', 58)" onmouseover="showTip(event, 'fs28', 58)" class="fn">min</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs27', 59)" onmouseover="showTip(event, 'fs27', 59)" class="id">wni</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs23', 60)" onmouseover="showTip(event, 'fs23', 60)" class="id">wi</span><span class="pn">)</span> <span class="n">0.0</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs26', 61)" onmouseover="showTip(event, 'fs26', 61)" class="id">wc</span>
            <span class="k">else</span> <span onmouseout="hideTip(event, 'fs28', 62)" onmouseover="showTip(event, 'fs28', 62)" class="fn">min</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs23', 63)" onmouseover="showTip(event, 'fs23', 63)" class="id">wi</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs27', 64)" onmouseover="showTip(event, 'fs27', 64)" class="id">wni</span><span class="pn">)</span> <span class="n">0.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs26', 65)" onmouseover="showTip(event, 'fs26', 65)" class="id">wc</span>
            
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 66)" onmouseover="showTip(event, 'fs29', 66)" class="id">d</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 67)" onmouseover="showTip(event, 'fs4', 67)" class="id">n</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs7', 68)" onmouseover="showTip(event, 'fs7', 68)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 69)" onmouseover="showTip(event, 'fs8', 69)" class="id">sum</span> <span onmouseout="hideTip(event, 'fs20', 70)" onmouseover="showTip(event, 'fs20', 70)" class="id">ns</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs30', 71)" onmouseover="showTip(event, 'fs30', 71)" class="id">__</span> <span class="o">=</span> <span class="n">1</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs12', 72)" onmouseover="showTip(event, 'fs12', 72)" class="fn">abs</span> <span onmouseout="hideTip(event, 'fs29', 73)" onmouseover="showTip(event, 'fs29', 73)" class="id">d</span> <span class="k">do</span>
            <span class="k">let</span> <span class="id">_</span><span class="pn">,</span><span class="id">_</span><span class="pn">,</span><span class="id">_</span><span class="pn">,</span><span onmouseout="hideTip(event, 'fs31', 74)" onmouseover="showTip(event, 'fs31', 74)" class="id">i</span> <span class="o">=</span>
                <span onmouseout="hideTip(event, 'fs10', 75)" onmouseover="showTip(event, 'fs10', 75)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs32', 76)" onmouseover="showTip(event, 'fs32', 76)" class="id">mapi2</span> <span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, 'fs31', 77)" onmouseover="showTip(event, 'fs31', 77)" class="id">i</span> <span onmouseout="hideTip(event, 'fs23', 78)" onmouseover="showTip(event, 'fs23', 78)" class="id">wi</span> <span onmouseout="hideTip(event, 'fs33', 79)" onmouseover="showTip(event, 'fs33', 79)" class="id">ni</span> <span class="k">-&gt;</span>
                    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 80)" onmouseover="showTip(event, 'fs34', 80)" class="id">absErr</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs22', 81)" onmouseover="showTip(event, 'fs22', 81)" class="fn">absoluteError</span> <span onmouseout="hideTip(event, 'fs23', 82)" onmouseover="showTip(event, 'fs23', 82)" class="id">wi</span> <span onmouseout="hideTip(event, 'fs33', 83)" onmouseover="showTip(event, 'fs33', 83)" class="id">ni</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs35', 84)" onmouseover="showTip(event, 'fs35', 84)" class="fn">sign</span> <span onmouseout="hideTip(event, 'fs29', 85)" onmouseover="showTip(event, 'fs29', 85)" class="id">d</span><span class="pn">)</span>
                    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 86)" onmouseover="showTip(event, 'fs36', 86)" class="id">relErr</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs34', 87)" onmouseover="showTip(event, 'fs34', 87)" class="id">absErr</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs12', 88)" onmouseover="showTip(event, 'fs12', 88)" class="fn">abs</span> <span onmouseout="hideTip(event, 'fs23', 89)" onmouseover="showTip(event, 'fs23', 89)" class="id">wi</span>
                    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 90)" onmouseover="showTip(event, 'fs37', 90)" class="id">weight</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs6', 91)" onmouseover="showTip(event, 'fs6', 91)" class="id">wt</span> <span class="o">&gt;</span> <span class="n">0.0</span> <span class="k">then</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs23', 92)" onmouseover="showTip(event, 'fs23', 92)" class="id">wi</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs23', 93)" onmouseover="showTip(event, 'fs23', 93)" class="id">wi</span>
                    <span onmouseout="hideTip(event, 'fs34', 94)" onmouseover="showTip(event, 'fs34', 94)" class="id">absErr</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs36', 95)" onmouseover="showTip(event, 'fs36', 95)" class="id">relErr</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs37', 96)" onmouseover="showTip(event, 'fs37', 96)" class="id">weight</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs31', 97)" onmouseover="showTip(event, 'fs31', 97)" class="id">i</span>
                <span class="pn">)</span> <span onmouseout="hideTip(event, 'fs5', 98)" onmouseover="showTip(event, 'fs5', 98)" class="id">weights</span> <span onmouseout="hideTip(event, 'fs20', 99)" onmouseover="showTip(event, 'fs20', 99)" class="id">ns</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 100)" onmouseover="showTip(event, 'fs10', 100)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs38', 101)" onmouseover="showTip(event, 'fs38', 101)" class="id">min</span>
            <span onmouseout="hideTip(event, 'fs20', 102)" onmouseover="showTip(event, 'fs20', 102)" class="id">ns</span><span class="m">.</span><span class="pn">[</span><span onmouseout="hideTip(event, 'fs31', 103)" onmouseover="showTip(event, 'fs31', 103)" class="id">i</span><span class="pn">]</span> <span class="k">&lt;-</span> <span onmouseout="hideTip(event, 'fs20', 104)" onmouseover="showTip(event, 'fs20', 104)" class="id">ns</span><span class="m">.</span><span class="pn">[</span><span onmouseout="hideTip(event, 'fs31', 105)" onmouseover="showTip(event, 'fs31', 105)" class="id">i</span><span class="pn">]</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs35', 106)" onmouseover="showTip(event, 'fs35', 106)" class="fn">sign</span> <span onmouseout="hideTip(event, 'fs29', 107)" onmouseover="showTip(event, 'fs29', 107)" class="id">d</span>
        <span onmouseout="hideTip(event, 'fs39', 108)" onmouseover="showTip(event, 'fs39', 108)" class="uc">Some</span> <span onmouseout="hideTip(event, 'fs20', 109)" onmouseover="showTip(event, 'fs20', 109)" class="id">ns</span>
</code></pre>
<h2><a name="Testing" class="anchor" href="#Testing">Testing</a></h2>
<p>The <code>twitter tricky</code> test below is interesting.
It is not clear which values should be adjusted down.
Neither the largest or smallest weights look like good candidates.
The error minimisation algorithm sensibly selects the second largest weight and keeps the correct order.</p>
<p>Testing also shows the algorithm is sensitive to weights that are close together and issues with machine precision.
This directs how the error function needs to calculate.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs56', 146)" onmouseover="showTip(event, 'fs56', 146)" class="id">roundingTests</span> <span class="o">=</span>
    <span class="id">testList</span> <span class="s">&quot;rounding&quot;</span> <span class="pn">[</span>

        <span class="id">test</span> <span class="s">&quot;empty&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 147)" onmouseover="showTip(event, 'fs3', 147)" class="id">distribute</span> <span class="n">1</span> <span class="pn">[|</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r</span> <span onmouseout="hideTip(event, 'fs16', 148)" onmouseover="showTip(event, 'fs16', 148)" class="id">None</span> <span class="s">&quot;empty&quot;</span>
        <span class="pn">}</span>

        <span class="id">test</span> <span class="s">&quot;n zero&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 149)" onmouseover="showTip(event, 'fs3', 149)" class="id">distribute</span> <span class="n">0</span> <span class="pn">[|</span><span class="n">406.0</span><span class="pn">;</span><span class="n">348.0</span><span class="pn">;</span><span class="n">246.0</span><span class="pn">;</span><span class="n">0.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 150)" onmouseover="showTip(event, 'fs39', 150)" class="id">Some</span> <span class="pn">[|</span><span class="n">0</span><span class="pn">;</span><span class="n">0</span><span class="pn">;</span><span class="n">0</span><span class="pn">;</span><span class="n">0</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;zero&quot;</span>
        <span class="pn">}</span>

        <span class="id">test</span> <span class="s">&quot;twitter&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 151)" onmouseover="showTip(event, 'fs3', 151)" class="id">distribute</span> <span class="n">100</span> <span class="pn">[|</span><span class="n">406.0</span><span class="pn">;</span><span class="n">348.0</span><span class="pn">;</span><span class="n">246.0</span><span class="pn">;</span><span class="n">0.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 152)" onmouseover="showTip(event, 'fs39', 152)" class="id">Some</span> <span class="pn">[|</span><span class="n">40</span><span class="pn">;</span><span class="n">35</span><span class="pn">;</span><span class="n">25</span><span class="pn">;</span><span class="n">0</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;40 etc&quot;</span>
        <span class="pn">}</span>

        <span class="id">test</span> <span class="s">&quot;twitter n negative&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 153)" onmouseover="showTip(event, 'fs3', 153)" class="id">distribute</span> <span class="o">-</span><span class="n">100</span> <span class="pn">[|</span><span class="n">406.0</span><span class="pn">;</span><span class="n">348.0</span><span class="pn">;</span><span class="n">246.0</span><span class="pn">;</span><span class="n">0.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 154)" onmouseover="showTip(event, 'fs39', 154)" class="id">Some</span> <span class="pn">[|</span><span class="o">-</span><span class="n">40</span><span class="pn">;</span><span class="o">-</span><span class="n">35</span><span class="pn">;</span><span class="o">-</span><span class="n">25</span><span class="pn">;</span><span class="n">0</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;-40 etc&quot;</span>
        <span class="pn">}</span>

        <span class="id">test</span> <span class="s">&quot;twitter weights negative&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 155)" onmouseover="showTip(event, 'fs3', 155)" class="id">distribute</span> <span class="n">100</span> <span class="pn">[|</span><span class="o">-</span><span class="n">406.0</span><span class="pn">;</span><span class="o">-</span><span class="n">348.0</span><span class="pn">;</span><span class="o">-</span><span class="n">246.0</span><span class="pn">;</span><span class="o">-</span><span class="n">0.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 156)" onmouseover="showTip(event, 'fs39', 156)" class="id">Some</span> <span class="pn">[|</span><span class="n">40</span><span class="pn">;</span><span class="n">35</span><span class="pn">;</span><span class="n">25</span><span class="pn">;</span><span class="n">0</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;40 etc&quot;</span>
        <span class="pn">}</span>

        <span class="id">test</span> <span class="s">&quot;twitter both negative&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 157)" onmouseover="showTip(event, 'fs3', 157)" class="id">distribute</span> <span class="o">-</span><span class="n">100</span> <span class="pn">[|</span><span class="o">-</span><span class="n">406.0</span><span class="pn">;</span><span class="o">-</span><span class="n">348.0</span><span class="pn">;</span><span class="o">-</span><span class="n">246.0</span><span class="pn">;</span><span class="o">-</span><span class="n">0.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 158)" onmouseover="showTip(event, 'fs39', 158)" class="id">Some</span> <span class="pn">[|</span><span class="o">-</span><span class="n">40</span><span class="pn">;</span><span class="o">-</span><span class="n">35</span><span class="pn">;</span><span class="o">-</span><span class="n">25</span><span class="pn">;</span><span class="n">0</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;-40 etc&quot;</span>
        <span class="pn">}</span>

        <span class="id">test</span> <span class="s">&quot;twitter tricky&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 159)" onmouseover="showTip(event, 'fs3', 159)" class="id">distribute</span> <span class="n">100</span> <span class="pn">[|</span><span class="n">404.0</span><span class="pn">;</span><span class="n">397.0</span><span class="pn">;</span><span class="n">57.0</span><span class="pn">;</span><span class="n">57.0</span><span class="pn">;</span><span class="n">57.0</span><span class="pn">;</span><span class="n">28.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 160)" onmouseover="showTip(event, 'fs39', 160)" class="id">Some</span> <span class="pn">[|</span><span class="n">40</span><span class="pn">;</span><span class="n">39</span><span class="pn">;</span><span class="n">6</span><span class="pn">;</span><span class="n">6</span><span class="pn">;</span><span class="n">6</span><span class="pn">;</span><span class="n">3</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;o no&quot;</span>
        <span class="pn">}</span>

        <span class="id">test</span> <span class="s">&quot;negative example&quot;</span> <span class="pn">{</span>
            <span class="k">let</span> <span class="id">r1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 161)" onmouseover="showTip(event, 'fs3', 161)" class="id">distribute</span> <span class="n">42</span> <span class="pn">[|</span><span class="n">1.5</span><span class="pn">;</span><span class="n">1.0</span><span class="pn">;</span><span class="n">39.5</span><span class="pn">;</span><span class="o">-</span><span class="n">1.0</span><span class="pn">;</span><span class="n">1.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r1</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 162)" onmouseover="showTip(event, 'fs39', 162)" class="id">Some</span> <span class="pn">[|</span><span class="n">2</span><span class="pn">;</span><span class="n">1</span><span class="pn">;</span><span class="n">39</span><span class="pn">;</span><span class="o">-</span><span class="n">1</span><span class="pn">;</span><span class="n">1</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;2 etc&quot;</span>
            <span class="k">let</span> <span class="id">r2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 163)" onmouseover="showTip(event, 'fs3', 163)" class="id">distribute</span> <span class="o">-</span><span class="n">42</span> <span class="pn">[|</span><span class="n">1.5</span><span class="pn">;</span><span class="n">1.0</span><span class="pn">;</span><span class="n">39.5</span><span class="pn">;</span><span class="o">-</span><span class="n">1.0</span><span class="pn">;</span><span class="n">1.0</span><span class="pn">|]</span>
            <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r2</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs39', 164)" onmouseover="showTip(event, 'fs39', 164)" class="id">Some</span> <span class="pn">[|</span><span class="o">-</span><span class="n">2</span><span class="pn">;</span><span class="o">-</span><span class="n">1</span><span class="pn">;</span><span class="o">-</span><span class="n">39</span><span class="pn">;</span><span class="n">1</span><span class="pn">;</span><span class="o">-</span><span class="n">1</span><span class="pn">|]</span><span class="pn">)</span> <span class="s">&quot;-2 etc&quot;</span>
        <span class="pn">}</span>

        <span onmouseout="hideTip(event, 'fs50', 165)" onmouseover="showTip(event, 'fs50', 165)" class="id">testProp</span> <span class="s">&quot;ni total correctly&quot;</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">n</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs48', 166)" onmouseover="showTip(event, 'fs48', 166)" class="id">Gen</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs49', 167)" onmouseover="showTip(event, 'fs49', 167)" class="id">RationalFloats</span> <span class="id">ws</span><span class="pn">)</span> <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs3', 168)" onmouseover="showTip(event, 'fs3', 168)" class="id">distribute</span> <span class="id">n</span> <span class="id">ws</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 169)" onmouseover="showTip(event, 'fs57', 169)" class="id">Option</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs58', 170)" onmouseover="showTip(event, 'fs58', 170)" class="id">iter</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">ns</span> <span class="k">-&gt;</span> <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs7', 171)" onmouseover="showTip(event, 'fs7', 171)" class="id">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 172)" onmouseover="showTip(event, 'fs8', 172)" class="id">sum</span> <span class="id">ns</span><span class="pn">)</span> <span class="id">n</span> <span class="s">&quot;sum ns = n&quot;</span><span class="pn">)</span>
        <span class="pn">)</span>

        <span onmouseout="hideTip(event, 'fs50', 173)" onmouseover="showTip(event, 'fs50', 173)" class="id">testProp</span> <span class="s">&quot;negative n returns opposite of positive n&quot;</span> <span class="pn">(</span>
            <span class="k">fun</span> <span class="id">n</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs48', 174)" onmouseover="showTip(event, 'fs48', 174)" class="id">Gen</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs49', 175)" onmouseover="showTip(event, 'fs49', 175)" class="id">RationalFloats</span> <span class="id">ws</span><span class="pn">)</span> <span class="k">-&gt;</span>
                <span class="k">let</span> <span class="id">r1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 176)" onmouseover="showTip(event, 'fs3', 176)" class="id">distribute</span> <span class="o">-</span><span class="id">n</span> <span class="id">ws</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 177)" onmouseover="showTip(event, 'fs57', 177)" class="id">Option</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs59', 178)" onmouseover="showTip(event, 'fs59', 178)" class="id">map</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs7', 179)" onmouseover="showTip(event, 'fs7', 179)" class="id">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs21', 180)" onmouseover="showTip(event, 'fs21', 180)" class="id">map</span> <span class="pn">(</span><span class="o">~-</span><span class="pn">)</span><span class="pn">)</span>
                <span class="k">let</span> <span class="id">r2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 181)" onmouseover="showTip(event, 'fs3', 181)" class="id">distribute</span> <span class="id">n</span> <span class="id">ws</span>
                <span class="id">Expect</span><span class="pn">.</span><span class="id">equal</span> <span class="id">r1</span> <span class="id">r2</span> <span class="s">&quot;r1 = r2&quot;</span>
        <span class="pn">)</span>

        <span onmouseout="hideTip(event, 'fs50', 182)" onmouseover="showTip(event, 'fs50', 182)" class="id">testProp</span> <span class="s">&quot;increase with weight&quot;</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">n</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs48', 183)" onmouseover="showTip(event, 'fs48', 183)" class="id">Gen</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs49', 184)" onmouseover="showTip(event, 'fs49', 184)" class="id">RationalFloats</span> <span class="id">ws</span><span class="pn">)</span> <span class="k">-&gt;</span>
            <span class="k">let</span> <span class="id">d</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs10', 185)" onmouseover="showTip(event, 'fs10', 185)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs60', 186)" onmouseover="showTip(event, 'fs60', 186)" class="id">sum</span> <span class="id">ws</span> <span class="pn">&gt;</span> <span class="n">0.0</span> <span class="o">&lt;&gt;</span> <span class="pn">(</span><span class="id">n</span><span class="pn">&gt;</span><span class="n">0</span><span class="pn">)</span> <span class="k">then</span> <span class="o">-</span><span class="n">1</span> <span class="k">else</span> <span class="n">1</span>
            <span onmouseout="hideTip(event, 'fs3', 187)" onmouseover="showTip(event, 'fs3', 187)" class="id">distribute</span> <span class="id">n</span> <span class="id">ws</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 188)" onmouseover="showTip(event, 'fs57', 188)" class="id">Option</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs58', 189)" onmouseover="showTip(event, 'fs58', 189)" class="id">iter</span> <span class="pn">(</span>
                   <span onmouseout="hideTip(event, 'fs10', 190)" onmouseover="showTip(event, 'fs10', 190)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs61', 191)" onmouseover="showTip(event, 'fs61', 191)" class="id">map</span> <span class="pn">(</span><span class="o">(*)</span><span class="id">d</span><span class="pn">)</span>
                <span class="pn">&gt;</span><span class="pn">&gt;</span> <span onmouseout="hideTip(event, 'fs10', 192)" onmouseover="showTip(event, 'fs10', 192)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs62', 193)" onmouseover="showTip(event, 'fs62', 193)" class="id">zip</span> <span class="id">ws</span>
                <span class="pn">&gt;</span><span class="pn">&gt;</span> <span onmouseout="hideTip(event, 'fs10', 194)" onmouseover="showTip(event, 'fs10', 194)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs63', 195)" onmouseover="showTip(event, 'fs63', 195)" class="id">sort</span>
                <span class="pn">&gt;</span><span class="pn">&gt;</span> <span onmouseout="hideTip(event, 'fs10', 196)" onmouseover="showTip(event, 'fs10', 196)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs64', 197)" onmouseover="showTip(event, 'fs64', 197)" class="id">pairwise</span>
                <span class="pn">&gt;</span><span class="pn">&gt;</span> <span onmouseout="hideTip(event, 'fs10', 198)" onmouseover="showTip(event, 'fs10', 198)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs65', 199)" onmouseover="showTip(event, 'fs65', 199)" class="id">iter</span> <span class="pn">(</span><span class="k">fun</span> <span class="pn">(</span><span class="id">ni1</span><span class="pn">,</span><span class="id">ni2</span><span class="pn">)</span> <span class="k">-&gt;</span>
                    <span class="id">Expect</span><span class="pn">.</span><span class="id">isLessThanOrEqual</span> <span class="id">ni1</span> <span class="id">ni2</span> <span class="s">&quot;ni1 &lt;= ni2&quot;</span><span class="pn">)</span>
            <span class="pn">)</span>
        <span class="pn">)</span>

        <span onmouseout="hideTip(event, 'fs50', 200)" onmouseover="showTip(event, 'fs50', 200)" class="id">testProp</span> <span class="s">&quot;smallest error&quot;</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">n</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs48', 201)" onmouseover="showTip(event, 'fs48', 201)" class="id">Gen</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs49', 202)" onmouseover="showTip(event, 'fs49', 202)" class="id">RationalFloats</span> <span class="id">ws</span><span class="pn">)</span> <span class="id">randomChanges</span> <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs3', 203)" onmouseover="showTip(event, 'fs3', 203)" class="id">distribute</span> <span class="id">n</span> <span class="id">ws</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 204)" onmouseover="showTip(event, 'fs57', 204)" class="id">Option</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs58', 205)" onmouseover="showTip(event, 'fs58', 205)" class="id">iter</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">ns</span> <span class="k">-&gt;</span>
                <span class="k">let</span> <span class="id">totalError</span> <span class="id">ns</span> <span class="o">=</span>
                    <span class="k">let</span> <span class="id">wt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 206)" onmouseover="showTip(event, 'fs10', 206)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs60', 207)" onmouseover="showTip(event, 'fs60', 207)" class="id">sum</span> <span class="id">ws</span>
                    <span onmouseout="hideTip(event, 'fs10', 208)" onmouseover="showTip(event, 'fs10', 208)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs66', 209)" onmouseover="showTip(event, 'fs66', 209)" class="id">map2</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">ni</span> <span class="id">wi</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs13', 210)" onmouseover="showTip(event, 'fs13', 210)" class="id">float</span> <span class="id">ni</span> <span class="pn">*</span> <span class="id">wt</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs13', 211)" onmouseover="showTip(event, 'fs13', 211)" class="id">float</span> <span class="id">n</span> <span class="o">-</span> <span class="id">wi</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 212)" onmouseover="showTip(event, 'fs12', 212)" class="id">abs</span>
                    <span class="pn">)</span> <span class="id">ns</span> <span class="id">ws</span>
                    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 213)" onmouseover="showTip(event, 'fs10', 213)" class="id">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs60', 214)" onmouseover="showTip(event, 'fs60', 214)" class="id">sum</span>

                <span class="k">let</span> <span class="id">errorBefore</span> <span class="o">=</span> <span class="id">totalError</span> <span class="id">ns</span>

                <span class="k">let</span> <span class="id">l</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 215)" onmouseover="showTip(event, 'fs7', 215)" class="id">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs67', 216)" onmouseover="showTip(event, 'fs67', 216)" class="id">length</span> <span class="id">ns</span>
                <span onmouseout="hideTip(event, 'fs68', 217)" onmouseover="showTip(event, 'fs68', 217)" class="id">List</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs69', 218)" onmouseover="showTip(event, 'fs69', 218)" class="id">iter</span> <span class="pn">(</span><span class="k">fun</span> <span class="pn">(</span><span class="id">i</span><span class="pn">,</span><span class="id">j</span><span class="pn">)</span> <span class="k">-&gt;</span>
                    <span class="id">ns</span><span class="pn">.</span><span class="pn">[</span><span onmouseout="hideTip(event, 'fs12', 219)" onmouseover="showTip(event, 'fs12', 219)" class="id">abs</span> <span class="id">i</span> <span class="o">%</span> <span class="id">l</span><span class="pn">]</span> <span class="k">&lt;-</span> <span class="id">ns</span><span class="pn">.</span><span class="pn">[</span><span onmouseout="hideTip(event, 'fs12', 220)" onmouseover="showTip(event, 'fs12', 220)" class="id">abs</span> <span class="id">i</span> <span class="o">%</span> <span class="id">l</span><span class="pn">]</span> <span class="o">-</span> <span class="n">1</span>
                    <span class="id">ns</span><span class="pn">.</span><span class="pn">[</span><span onmouseout="hideTip(event, 'fs12', 221)" onmouseover="showTip(event, 'fs12', 221)" class="id">abs</span> <span class="id">j</span> <span class="o">%</span> <span class="id">l</span><span class="pn">]</span> <span class="k">&lt;-</span> <span class="id">ns</span><span class="pn">.</span><span class="pn">[</span><span onmouseout="hideTip(event, 'fs12', 222)" onmouseover="showTip(event, 'fs12', 222)" class="id">abs</span> <span class="id">j</span> <span class="o">%</span> <span class="id">l</span><span class="pn">]</span> <span class="o">+</span> <span class="n">1</span>
                <span class="pn">)</span> <span class="id">randomChanges</span>

                <span class="k">let</span> <span class="id">errorAfter</span> <span class="o">=</span> <span class="id">totalError</span> <span class="id">ns</span>

                <span class="id">Expect</span><span class="pn">.</span><span class="id">floatLessThanOrClose</span>
                    <span class="id">Accuracy</span><span class="pn">.</span><span class="id">veryHigh</span> <span class="id">errorBefore</span> <span class="id">errorAfter</span> <span class="s">&quot;before &lt;= after&quot;</span>
                <span class="pn">)</span>
        <span class="pn">)</span>

    <span class="pn">]</span>
</code></pre>
<h2><a name="Conclusion" class="anchor" href="#Conclusion">Conclusion</a></h2>
<p>This is an example of how property based testing can actually help in algorithm design.
It gives example failing cases that can steer you to a better solution.</p>
<p>I have seen this problem in order management systems where orders for a number of shares are to be allocated across a number of portfolios.
The buy and sell orders have a number of partial fills, but ultimately everything needs to add up in a consistent and robust way.</p>
<p>Error minimisation is the best rounding algorithm I have found.
By construction it is also the one with the smallest total rounding error.</p>
<p>I don't think there is any other general purpose algorithm that can satisfy these properties as well.</p>


<div class="tip" id="fs1">module Rounding</div>
<div class="tip" id="fs2">namespace System</div>
<div class="tip" id="fs3">val distribute : n:int -&gt; weights:float [] -&gt; int [] option<br /><em><br /><br />&#160;Distribute integer n over an array of weights</em></div>
<div class="tip" id="fs4">val n : int</div>
<div class="tip" id="fs5">val weights : float []</div>
<div class="tip" id="fs6">val wt : float</div>
<div class="tip" id="fs7">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : [&lt;ParamArray&gt;] indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...</div>
<div class="tip" id="fs8">val sum : array:&#39;T [] -&gt; &#39;T (requires member ( + ) and member get_Zero)</div>
<div class="tip" id="fs9">val isEmpty : array:&#39;T [] -&gt; bool</div>
<div class="tip" id="fs10">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs11">val maxBy : projection:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires comparison)</div>
<div class="tip" id="fs12">val abs : value:&#39;T -&gt; &#39;T (requires member Abs)</div>
<div class="tip" id="fs13">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />--------------------<br />type float = Double<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float</div>
<div class="tip" id="fs14">type Int32 =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;&#160;&#160;member Equals : obj:obj -&gt; bool + 1 overload<br />&#160;&#160;&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;&#160;&#160;member GetTypeCode : unit -&gt; TypeCode<br />&#160;&#160;&#160;&#160;member ToString : unit -&gt; string + 3 overloads<br />&#160;&#160;&#160;&#160;static val MaxValue : int<br />&#160;&#160;&#160;&#160;static val MinValue : int<br />&#160;&#160;&#160;&#160;static member Parse : s:string -&gt; int + 3 overloads<br />&#160;&#160;&#160;&#160;static member TryParse : s:string * result:int -&gt; bool + 1 overload<br />&#160;&#160;end</div>
<div class="tip" id="fs15">field int.MaxValue: int = 2147483647</div>
<div class="tip" id="fs16">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs17">val round : (float -&gt; int)</div>
<div class="tip" id="fs18">val f : float</div>
<div class="tip" id="fs19">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />--------------------<br />type int = int32<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int</div>
<div class="tip" id="fs20">val ns : int []</div>
<div class="tip" id="fs21">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []</div>
<div class="tip" id="fs22">val absoluteError : (float -&gt; &#39;a -&gt; &#39;b -&gt; float) (requires member op_Explicit and member op_Explicit)</div>
<div class="tip" id="fs23">val wi : float</div>
<div class="tip" id="fs24">val ni : &#39;a (requires member op_Explicit)</div>
<div class="tip" id="fs25">val d : &#39;b (requires member op_Explicit)</div>
<div class="tip" id="fs26">val wc : float</div>
<div class="tip" id="fs27">val wni : float</div>
<div class="tip" id="fs28">val min : e1:&#39;T -&gt; e2:&#39;T -&gt; &#39;T (requires comparison)</div>
<div class="tip" id="fs29">val d : int</div>
<div class="tip" id="fs30">val __ : int</div>
<div class="tip" id="fs31">val i : int</div>
<div class="tip" id="fs32">val mapi2 : mapping:(int -&gt; &#39;T1 -&gt; &#39;T2 -&gt; &#39;U) -&gt; source1:seq&lt;&#39;T1&gt; -&gt; source2:seq&lt;&#39;T2&gt; -&gt; seq&lt;&#39;U&gt;</div>
<div class="tip" id="fs33">val ni : int</div>
<div class="tip" id="fs34">val absErr : float</div>
<div class="tip" id="fs35">val sign : value:&#39;T -&gt; int (requires member get_Sign)</div>
<div class="tip" id="fs36">val relErr : float</div>
<div class="tip" id="fs37">val weight : float</div>
<div class="tip" id="fs38">val min : source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires comparison)</div>
<div class="tip" id="fs39">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs40">Multiple items<br />union case RationalFloats.RationalFloats: float [] -&gt; RationalFloats<br /><br />--------------------<br />type RationalFloats = | RationalFloats of float []</div>
<div class="tip" id="fs41">val rationalFloats : obj</div>
<div class="tip" id="fs42">val fraction : (int -&gt; int -&gt; int -&gt; float)</div>
<div class="tip" id="fs43">val a : int</div>
<div class="tip" id="fs44">val b : int</div>
<div class="tip" id="fs45">val c : int</div>
<div class="tip" id="fs46">val private config : obj</div>
<div class="tip" id="fs47">val typeof&lt;&#39;T&gt; : Type</div>
<div class="tip" id="fs48">module Gen<br /><br />from Rounding</div>
<div class="tip" id="fs49">Multiple items<br />union case Gen.RationalFloats.RationalFloats: float [] -&gt; Gen.RationalFloats<br /><br />--------------------<br />type RationalFloats = | RationalFloats of float []</div>
<div class="tip" id="fs50">val testProp : name:&#39;a -&gt; &#39;b</div>
<div class="tip" id="fs51">val name : &#39;a</div>
<div class="tip" id="fs52">val ptestProp : name:&#39;a -&gt; &#39;b</div>
<div class="tip" id="fs53">val ftestProp : stdgen:&#39;a -&gt; name:&#39;b -&gt; &#39;c</div>
<div class="tip" id="fs54">val stdgen : &#39;a</div>
<div class="tip" id="fs55">val name : &#39;b</div>
<div class="tip" id="fs56">val roundingTests : obj</div>
<div class="tip" id="fs57">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs58">val iter : action:(&#39;T -&gt; unit) -&gt; option:&#39;T option -&gt; unit</div>
<div class="tip" id="fs59">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; option:&#39;T option -&gt; &#39;U option</div>
<div class="tip" id="fs60">val sum : source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires member ( + ) and member get_Zero)</div>
<div class="tip" id="fs61">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;</div>
<div class="tip" id="fs62">val zip : source1:seq&lt;&#39;T1&gt; -&gt; source2:seq&lt;&#39;T2&gt; -&gt; seq&lt;&#39;T1 * &#39;T2&gt;</div>
<div class="tip" id="fs63">val sort : source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt; (requires comparison)</div>
<div class="tip" id="fs64">val pairwise : source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T * &#39;T&gt;</div>
<div class="tip" id="fs65">val iter : action:(&#39;T -&gt; unit) -&gt; source:seq&lt;&#39;T&gt; -&gt; unit</div>
<div class="tip" id="fs66">val map2 : mapping:(&#39;T1 -&gt; &#39;T2 -&gt; &#39;U) -&gt; source1:seq&lt;&#39;T1&gt; -&gt; source2:seq&lt;&#39;T2&gt; -&gt; seq&lt;&#39;U&gt;</div>
<div class="tip" id="fs67">val length : array:&#39;T [] -&gt; int</div>
<div class="tip" id="fs68">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;&#160;&#160;interface IReadOnlyList&lt;&#39;T&gt;<br />&#160;&#160;&#160;&#160;interface IReadOnlyCollection&lt;&#39;T&gt;<br />&#160;&#160;&#160;&#160;interface IEnumerable<br />&#160;&#160;&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;&#160;&#160;member Head : &#39;T<br />&#160;&#160;&#160;&#160;member IsEmpty : bool<br />&#160;&#160;&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;&#160;&#160;member Length : int<br />&#160;&#160;&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;&#160;&#160;...</div>
<div class="tip" id="fs69">val iter : action:(&#39;T -&gt; unit) -&gt; list:&#39;T list -&gt; unit</div>
